<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Wolfeyes Bioinformatics beta]]></title>
  <link href="http://yagays.github.com/atom.xml" rel="self"/>
  <link href="http://yagays.github.com/"/>
  <updated>2012-12-04T17:55:47+09:00</updated>
  <id>http://yagays.github.com/</id>
  <author>
    <name><![CDATA[yag_ays]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[「系統樹曼荼羅―チェイン・ツリー・ネットワーク」読了]]></title>
    <link href="http://yagays.github.com/blog/2012/12/04/review-phylogeny-mandala/"/>
    <updated>2012-12-04T15:12:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/12/04/review-phylogeny-mandala</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4757142633" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>久々に，眺めるだけで楽しく好奇心を刺激される本に出会った．まさに大人の図鑑といった趣で，とにかく見ているだけで楽しい．もちろん系統樹の歴史であったり掲載されている図版の説明もしっかりと書かれているので，文章を読んで楽しい本でもある．しかしながら，次々と目に飛び込んでくる古今東西ありとあらゆる種類の系統樹たるや，早く色んな絵を見たいと文字を追うのを忘れてページをめくりたいと思わせるほどである．</p>

<p>本書は「<a href="http://www.amazon.co.jp/gp/product/4061498495/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4061498495&linkCode=as2&tag=yagays-22">系統樹思考の世界 (講談社現代新書)</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4061498495" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」や「<a href="http://www.amazon.co.jp/gp/product/4062880148/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4062880148&linkCode=as2&tag=yagays-22">分類思考の世界 (講談社現代新書)</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4062880148" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」などの著作で知られる三中信宏氏の著作である．図版に関しては杉山久仁彦氏が別にクレジットされているが，「<a href="http://www.amazon.co.jp/gp/product/4532511852/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4532511852&linkCode=as2&tag=yagays-22">進化が語る 現在・過去・未来(別冊日経サイエンス185) (別冊日経サイエンス 185)</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4532511852" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」にある茂木健一郎氏との対談を読む限りでは，三中氏本人も相当のコレクターであると思われる．本書では，三中氏の専門に深いつながりがある系統樹のみならず，人間がこれまで生み出してきた分類にまつわるありとあらゆる図形に焦点をあてることによって，人間がオブジェクトを分類するという行為について体系化しようといった内容となっている．この中で紹介される図版は，大昔にかかれた家系図から始まり，宗教画などのモチーフ，ヘッケルの分類体系以降の科学的な記述，そして現代の複雑ネットワークなどの可視化にまで及ぶ．これはまさに「図形言語」と呼ぶに相応しい自然言語と並ぶ人類の発明であり，人間がどのように考える道具として図形を扱ってきたのかといった歴史を辿るものでもある．そういった系統樹に代表される図形を通して，図形が何を示しているのかといった基本的な読み方から，様々な工夫が加えられていく図形の変移の過程，そして副題にもあるチェイン・ツリー・ネットワークという概念の構築が考察される．</p>

<p>本書はタイトルに系統樹とあって生物学としてのイメージが強いものの，ある程度知識があればどんな分野の人でも楽しく読める内容だと思われる．個人的には，特に統計や情報系の人間であればベン図の表記に慣れ親しんでいるし，デンドログラムはどの段階で見るかでクラスタリング結果が違ってくるといったことはよく知られているわけで，もしかしたら生物学の人間以上に楽しめるんじゃないかと思う．ノードとエッジを基本にしたグラフ理論に繋がる話題でもあるし，最近のインフォグラフィックとしても興味深く見ることができる．そういった意味でも，生物系と情報系の中間にいる私にとっては，非常に満足度の高い1冊だった．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[新しいことを始めるよりも日々の生活の手段を少し変える方が自分には向いている]]></title>
    <link href="http://yagays.github.com/blog/2012/12/03/misc-bicycle/"/>
    <updated>2012-12-03T10:56:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/12/03/misc-bicycle</id>
    <content type="html"><![CDATA[<h3>新しいオモチャへの期待</h3>

<p>2年くらい前に10万円ほどする自転車を買った．その自転車はロードバイクの中でもエントリーモデルで特に性能が良いわけでもないのだが，今までの僕の自転車に乗るという体験を全く別のものに変えてしまうほどの乗り心地だった．今でも当時の感覚は鮮明に残っているし，自転車に乗るのはとても楽しい．もっとハイクラスな自転車を欲しくなるし，自転車をもっと上手く乗り回したいという気持ちもある．</p>

<p>自転車を買った当初は，これで僕の生活はガラリと変わるだろうと思っていた．前々からやりたいと思っていたツーリングにも行けるし，あっちこっち遊びに行って写真を撮ったり新しい体験ができる，そして適度な運動もできて健康になるかもしれない．そんな希望とも目標ともつかないようなやんわりとしたイメージを自転車に抱きながら，新しく手に入ったオモチャで遊んでいた．</p>

<p>そのような時期から2年が経ち，改めて現在の自分の生活を振り返ってみると，達成できたものもあり達成できなかったものもある．</p>

<h3>ツーリングは続かなかった</h3>

<p>自転車を買って，まず荒川の河川敷に出かけるところから始めた．そこには葛西臨海公園近くの河口付近から上流に向かって川沿いに整備された道があり，サイクリングロードではないものの，平坦で長い距離をずっと走ることができる．当時は新しい自転車に慣れていなかったり，そもそも自転車に乗るための筋力が全くなかったこともあって，トレーニングとしてその道をよく自転車で走った．信号機などの障害がほとんど無い道なので，走ろうと思えば30分でも1時間でも走っていられる．また，天気のいい日の荒川河川敷から見る日の出は本当に美しく，東京であることを忘れるくらいの清々しい気分にさせてくれる．このように，自転車乗りとしてはとても良い場所であることには間違いないのだが，徐々に出かける回数が減り，最近ではめっきり足が遠のいてしまった．ある程度飽きてしまったからかもしれないし，時間を確保してその日の天気と体調を確認してといったように，意識して準備しなければいけないことが多いからかもしれない．</p>

<h3>都内の移動はもっぱら自転車になった</h3>

<p>一方で，都内の主な移動手段としての自転車が，僕の生活の中で非常に大きな位置を占めるようになった．電車での移動がほとんど無くなり，代わりに自転車であちこちに出かけるようになった．それまで電車で移動していた距離くらいなら，自転車を使ったほうが早く着くし交通費が掛からない．もちろん遠出は無理だし天気のいい日に限るが，それでも普段の移動の半分以上は自転車に置き換わったと言っていい．電車と自転車を使い分けるときの境界線は，移動時間がだいたい30分を超えるか超えないかくらいだと思う．それくらいの時間でも，僕の家からだと山手線の中はほとんど網羅できる．そうなると，もはや普段からよく行く場所は自然と自転車での移動となった．おまけに，自転車で移動するコストは非常に低いので，普段電車で行くほどでもないような場所にも気軽に足を運ぶことができる．神保町なんかは自転車に乗るようになってから頻繁に通うようになった場所の一つだ．特に欲しい物が無いときでも，ふらっと出かけては店の表に積まれている安売りの本を眺めたりしている．また，深夜に新宿に出掛けては，終電に乗れないくらいの時間帯の空いている映画館で一人映画を見ることも多くなった．といったように，移動手段の変化によって僕の生活の一部は自転車無しでは考えられないくらいにまでに色々な習慣が定着した．</p>

<h3>まとめ</h3>

<p>結局のところ自転車を買ったことで生活は色々な面で変わったものの，当初予想していたところからはだいぶ違うところに来てしまったしまった．それでも今の自転車のある生活にはかなり満足しているし，僕の性格がよく表れているような気がする．</p>

<h3>私信</h3>

<p>ということで，たとえ僕が高級デジイチを買ったとしても途中で飽きそうなので，カメラは買いません．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Machine Learning Advent Calendar 2012でギブスサンプリングの記事を書きました]]></title>
    <link href="http://yagays.github.com/blog/2012/12/02/qiita-ml-advent-calendar-day2/"/>
    <updated>2012-12-02T21:58:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/12/02/qiita-ml-advent-calendar-day2</id>
    <content type="html"><![CDATA[<ul>
<li><a href="http://qiita.com/advent-calendar/2012/machinelearning">Machine Learning Advent Calendar 2012 - Qiita</a></li>
<li><a href="http://qiita.com/items/5bde6addf228b1fe24e6">PRML 11章 二変量正規分布からのギブスサンプリング #PRML #R - Qiita</a></li>
</ul>


<p>今年も残すところあと1ヶ月ということで，毎年恒例になりつつあるAdvent Calendarが各所で盛り上がっているようです．私もQiitaで開催されているMachine Learning Advent Calendar 2012の2日目で，ギブスサンプリングに関する記事を書きました．こんな動画を撮って遊んでいます．もしよければ本記事の方も御覧ください．</p>

<iframe width="480" height="360" src="http://www.youtube.com/embed/ZaKwpVgmKTY" frameborder="0" allowfullscreen></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「パターン認識と機械学習」1章 多項式曲線フィッティングをRで書いてみた]]></title>
    <link href="http://yagays.github.com/blog/2012/12/01/prml-1-takousiki/"/>
    <updated>2012-12-01T05:17:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/12/01/prml-1-takousiki</id>
    <content type="html"><![CDATA[<h3>事の発端</h3>

<blockquote class="twitter-tweet"><p>これこれ、これですよ / “PRML読書会第一回 - Seeking for my unique color.” <a href="http://t.co/qtGtiKuO" title="http://htn.to/w8bGen">htn.to/w8bGen</a></p>&mdash; Yokoyama T (@wakuteka) <a href="https://twitter.com/wakuteka/status/272995562582835201" data-datetime="2012-11-26T09:29:48+00:00">November 26, 2012</a></blockquote>


<script src="http://yagays.github.com//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>先日「<a href="http://d.hatena.ne.jp/syou6162/20080801/1217528370">PRML読書会第一回 - Seeking for my unique color.</a>」のソースコードが一部界隈で局地的に話題にあがり，やれ</p>

<ul>
<li>takousikiってなんだよロシア人かよ</li>
</ul>


<p>だとか</p>

<ul>
<li>evalが多すぎて引いた</li>
</ul>


<p>だのといった罵詈雑言が（主に僕の口から）飛び交っていたわけだけれども，さすがに言うだけではsyou6162先生に申し訳ないと感じ，改めて彼のコードをRで書きなおしてみることにした．</p>

<h3>多項式曲線フィッティングのコードを書き直す</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>f <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>sin<span class="p">(</span><span class="m">2</span><span class="o">*</span>pi<span class="o">*</span>x<span class="p">)}</span>
</span><span class='line'>
</span><span class='line'>takousiki <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>n<span class="p">){</span>
</span><span class='line'>  x <span class="o">&lt;-</span> numeric<span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span><span class='line'>  z <span class="o">&lt;-</span> numeric<span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">1</span>:n<span class="p">){</span>
</span><span class='line'>    x <span class="o">&lt;-</span> cbind<span class="p">(</span>x<span class="p">,</span> seq<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.1</span><span class="p">)</span><span class="o">^</span>i<span class="p">)</span>
</span><span class='line'>    z <span class="o">&lt;-</span> cbind<span class="p">(</span>z<span class="p">,</span> seq<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.01</span><span class="p">)</span><span class="o">^</span>i<span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  data <span class="o">&lt;-</span> data.frame<span class="p">(</span>f<span class="p">(</span>seq<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.1</span><span class="p">))</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">11</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span><span class="m">0.5</span><span class="p">),</span> x<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  colnames<span class="p">(</span>data<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span>paste<span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span>as.character<span class="p">(</span><span class="m">1</span>:n<span class="p">),</span>sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
</span><span class='line'>  colnames<span class="p">(</span>z<span class="p">)</span> <span class="o">&lt;-</span> paste<span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span>as.character<span class="p">(</span><span class="m">1</span>:n<span class="p">),</span>sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># predict</span>
</span><span class='line'>  fit <span class="o">&lt;-</span> lm<span class="p">(</span>y ~ <span class="m">.</span><span class="p">,</span> data<span class="o">=</span>data<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  plot<span class="p">(</span>data<span class="p">[,</span><span class="m">2</span><span class="p">],</span> data<span class="p">[,</span><span class="m">1</span><span class="p">],</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">-1.5</span><span class="p">,</span><span class="m">1.5</span><span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;M=&quot;</span><span class="p">,</span>n<span class="p">))</span>
</span><span class='line'>  curve<span class="p">(</span>f<span class="p">(</span>x<span class="p">),</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>  lines<span class="p">(</span>seq<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.01</span><span class="p">),</span> predict<span class="p">(</span>fit<span class="p">,</span>data.frame<span class="p">(</span>z<span class="p">)),</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>使い方としては，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>takousiki<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>takousiki<span class="p">(</span><span class="m">3</span><span class="p">)</span>
</span><span class='line'>takousiki<span class="p">(</span><span class="m">8</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>とすると，多項式で曲線フィッティングした結果がプロットされる．ただし切片だけの0次は書けない．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/prml_takousiki.png" alt="" /></p>

<p>サンプルデータの生成と推定した曲線の描写用のデータの生成を同時に行なっているため，コードがちょっと見にくいかもしれない．基本的に<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x%5E2+" alt="x^2 " />や<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x%5E3+" alt="x^3 " />などの多項式の各項の値をあらかじめデータフレームとして作っておいて，lm()関数で回帰するときのモデルを簡略化している．あと，関数名はオリジナルを踏襲しているので，あしからず．</p>

<h3>他の方法としては</h3>

<p>lm()関数などに渡すモデルは，as.formula()関数を使うことによって文字列から生成することができる．この方法もかなり簡単に使うことができるので，データフレームの列名を規則的に付けている場合などは使い勝手は良いと思われる．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> n <span class="o">&lt;-</span> <span class="m">5</span>
</span><span class='line'><span class="o">&gt;</span> as.formula<span class="p">(</span>paste<span class="p">(</span><span class="s">&quot;y~&quot;</span><span class="p">,</span>paste<span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="m">1</span>:n<span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>collapse<span class="o">=</span><span class="s">&quot;+&quot;</span><span class="p">)))</span>
</span><span class='line'>y ~ x1 <span class="o">+</span> x2 <span class="o">+</span> x3 <span class="o">+</span> x4 <span class="o">+</span> x5
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによるモンテカルロ法入門」読書ノート：6章 メトロポリス・ヘイスティング・アルゴリズム その3]]></title>
    <link href="http://yagays.github.com/blog/2012/11/30/imcmr-6-5/"/>
    <updated>2012-11-30T05:04:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/30/imcmr-6-5</id>
    <content type="html"><![CDATA[<ul>
<li>読書ノート アーカイブ：<a href="http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/">http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>練習問題 6.13</h3>

<p>この問題は<a href="http://yagays.github.com/blog/2012/11/25/imcmr-6-3/">例6.3</a>と同じく，線形回帰におけるパラメータの事後分布からメトロポリス・ヘイスティング・アルゴリズムを用いてサンプリングを行うことを目標とする．線形回帰の対象はmcsmパッケージに収められているchallengerデータセットで，過去に打ち上げられたスペースシャトルにおけるOリングの破損の有無と，その時の気温に関するものである．</p>

<h3>a. glm()関数を使ってロジスティック回帰を行う</h3>

<p>打ち上げられたスペースシャトルのOリングは破損しているかしていないかの2値で表されるため，今回はロジスティック回帰を用いた当てはめを行う．Oリングが破損している場合は1を，破損していない場合には0が割り当てられており，ある気温<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x_i+" alt="x_i " />におけるOリングの破損確率は</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=P%28x_i%29+%3D+%5Cfrac%7B%5Cexp%28%5Calpha%2B%5Cbeta_i%29%7D%7B1%2B%5Cexp%28%5Calpha%2B%5Cbeta_i%29%7D+" alt="P(x_i) = \frac{\exp(\alpha+\beta_i)}{1+\exp(\alpha+\beta_i)} " /></p>

<p>で表される．今回はこの<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Calpha+" alt="\alpha " />と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cbeta+" alt="\beta " />をglm()関数を使って推定する．</p>

<p>なお，以下のコードではロジスティック関数を式変形して<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cfrac%7B1%7D%7B1%2B%5Cexp%28-%28%5Calpha%2B%5Cbeta_i%29%29%7D+" alt="\frac{1}{1+\exp(-(\alpha+\beta_i))} " />として計算している．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>library<span class="p">(</span>mcsm<span class="p">)</span>
</span><span class='line'>data<span class="p">(</span>challenger<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>fit <span class="o">&lt;-</span> glm<span class="p">(</span>oring ~ temp<span class="p">,</span> data<span class="o">=</span>challenger<span class="p">,</span> family<span class="o">=</span>binomial<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>challenger<span class="p">$</span>temp<span class="p">,</span> challenger<span class="p">$</span>oring<span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
</span><span class='line'>curve<span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span>exp<span class="p">(</span><span class="o">-</span><span class="p">(</span>fit<span class="p">$</span>coef<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">+</span>fit<span class="p">$</span>coef<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span>x<span class="p">))),</span> from<span class="o">=</span><span class="m">53</span><span class="p">,</span> to<span class="o">=</span><span class="m">81</span><span class="p">,</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-13_1.png" alt="" /></p>

<p>この図は，横軸に気温（華氏），縦軸にOリングの破損の有無をプロットしたものである．また，glm()関数で推定したロジスティック曲線をオレンジ色で示しており，任意の気温における破損する確率と対応している．この図を見ると，華氏65前後で破損確率が50%となり，気温が高い場合は破損確率が低く，逆に気温が低い時には破損確率が高いことがわかる．</p>

<p>glm()関数のパラメータ推定の詳細は以下の通り．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> summary<span class="p">(</span>fit<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>Call:
</span><span class='line'>glm<span class="p">(</span>formula <span class="o">=</span> oring ~ temp<span class="p">,</span> family <span class="o">=</span> binomial<span class="p">,</span> data <span class="o">=</span> challenger<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>Deviance Residuals:
</span><span class='line'>    Min       <span class="m">1</span>Q   Median       <span class="m">3</span>Q      Max
</span><span class='line'><span class="m">-1.0611</span>  <span class="m">-0.7613</span>  <span class="m">-0.3783</span>   <span class="m">0.4524</span>   <span class="m">2.2175</span>
</span><span class='line'>
</span><span class='line'>Coefficients:
</span><span class='line'>            Estimate Std. Error z value Pr<span class="p">(</span><span class="o">&gt;|</span>z<span class="o">|</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span>Intercept<span class="p">)</span>  <span class="m">15.0429</span>     <span class="m">7.3786</span>   <span class="m">2.039</span>   <span class="m">0.0415</span> <span class="o">*</span>
</span><span class='line'>temp         <span class="m">-0.2322</span>     <span class="m">0.1082</span>  <span class="m">-2.145</span>   <span class="m">0.0320</span> <span class="o">*</span>
</span><span class='line'><span class="o">---</span>
</span><span class='line'>Signif. codes:  <span class="m">0</span> ‘<span class="o">***</span>’ <span class="m">0.001</span> ‘<span class="o">**</span>’ <span class="m">0.01</span> ‘<span class="o">*</span>’ <span class="m">0.05</span> ‘<span class="m">.</span>’ <span class="m">0.1</span> ‘ ’ <span class="m">1</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span>Dispersion parameter for binomial family taken to be <span class="m">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    Null deviance: <span class="m">28.267</span>  on <span class="m">22</span>  degrees of freedom
</span><span class='line'>Residual deviance: <span class="m">20.315</span>  on <span class="m">21</span>  degrees of freedom
</span><span class='line'>AIC: <span class="m">24.315</span>
</span><span class='line'>
</span><span class='line'>Number of Fisher Scoring iterations: <span class="m">5</span>
</span></code></pre></td></tr></table></div></figure>


<h4>b. ロジスティック回帰で推定したパラメータの値を用いて，メトロポリス・ヘイスティング・アルゴリズムでサンプリングを行う</h4>

<p>これは<a href="http://yagays.github.com/blog/2012/11/25/imcmr-6-3/">前回</a>と殆ど変わらず．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>y <span class="o">&lt;-</span> challenger<span class="p">$</span>oring
</span><span class='line'>x <span class="o">&lt;-</span> challenger<span class="p">$</span>temp
</span><span class='line'>
</span><span class='line'>loglik <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">){</span>sum<span class="p">(</span>y<span class="o">*</span><span class="p">(</span>a<span class="o">+</span>b<span class="o">*</span>x<span class="p">)</span> <span class="o">-</span> log<span class="p">(</span><span class="m">1</span><span class="o">+</span>exp<span class="p">(</span>a<span class="o">+</span>b<span class="o">*</span>x<span class="p">)))}</span>
</span><span class='line'>logq <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">){</span>
</span><span class='line'>  dnorm<span class="p">(</span>a<span class="p">,</span>mean<span class="o">=</span>a.est<span class="p">[</span><span class="m">1</span><span class="p">],</span>sd<span class="o">=</span>a.std<span class="p">,</span>log<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>
</span><span class='line'>  <span class="o">+</span> dnorm<span class="p">(</span>b<span class="p">,</span>mean<span class="o">=</span>b.est<span class="p">[</span><span class="m">1</span><span class="p">],</span>sd<span class="o">=</span>b.std<span class="p">,</span>log<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>Niter <span class="o">&lt;-</span> <span class="m">5000</span>
</span><span class='line'>n <span class="o">&lt;-</span> length<span class="p">(</span>challenger<span class="p">$</span>temp<span class="p">)</span>
</span><span class='line'>fit.param <span class="o">&lt;-</span> summary<span class="p">(</span>fit<span class="p">)$</span>coef
</span><span class='line'>a.est <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>a.std <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>b.est <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>b.std <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>  candidate <span class="o">&lt;-</span> c<span class="p">(</span>rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span>a.est<span class="p">[</span><span class="m">1</span><span class="p">],</span> sd<span class="o">=</span>a.std<span class="p">),</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span>b.est<span class="p">[</span><span class="m">1</span><span class="p">],</span> sd<span class="o">=</span>b.std<span class="p">))</span>
</span><span class='line'>  fy <span class="o">&lt;-</span> loglik<span class="p">(</span>candidate<span class="p">[</span><span class="m">1</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">])</span>
</span><span class='line'>  fx <span class="o">&lt;-</span> loglik<span class="p">(</span>a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])</span>
</span><span class='line'>  qxy <span class="o">&lt;-</span> logq<span class="p">(</span>a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])</span>
</span><span class='line'>  qyx <span class="o">&lt;-</span> logq<span class="p">(</span>candidate<span class="p">[</span><span class="m">1</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">])</span>
</span><span class='line'>  rho <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span>fy<span class="o">-</span>fx<span class="o">+</span>qxy<span class="o">-</span>qyx<span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">if</span> <span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&lt;</span>rho<span class="p">){</span>
</span><span class='line'>    a.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    b.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>    a.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    b.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>plot<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;temp&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;oring&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="p">(</span>Niter<span class="o">-</span><span class="m">500</span><span class="p">)</span>:Niter<span class="p">){</span>
</span><span class='line'>  lines<span class="p">(</span>x<span class="p">,</span> <span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span>exp<span class="p">(</span><span class="o">-</span><span class="p">(</span>a.est<span class="p">[</span>i<span class="p">]</span><span class="o">+</span>b.est<span class="p">[</span>i<span class="p">]</span><span class="o">*</span>x<span class="p">))),</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;grey&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>curve<span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span>exp<span class="p">(</span><span class="o">-</span><span class="p">(</span>fit<span class="p">$</span>coef<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">+</span>fit<span class="p">$</span>coef<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span>x<span class="p">))),</span> from<span class="o">=</span><span class="m">53</span><span class="p">,</span> to<span class="o">=</span><span class="m">81</span><span class="p">,</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
</span><span class='line'>points<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>c. 5000回のマルコフ連鎖によるサンプル列を生成し，サンプリングで得られた推定値を使ったロジスティック曲線を図示する</h4>

<p>実際に上で書いたコードを動かして，事後分布からのサンプリングを行い，得られたサンプルのうち4500回から5000回までの反復で生成した当てはめ曲線を灰色の曲線で表している．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-13_2.png" alt="" /></p>

<p>また，パラメータ<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Calpha+" alt="\alpha " />と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cbeta+" alt="\beta " />の系列の変動，自己相関プロット，系列の分布を以下の図で示している．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> a.est<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span>expression<span class="p">(</span>alpha<span class="p">))</span>
</span><span class='line'>acf<span class="p">(</span>a.est<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>a.est<span class="p">))</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> b.est<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span>expression<span class="p">(</span>beta<span class="p">))</span>
</span><span class='line'>acf<span class="p">(</span>b.est<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>b.est<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-13_3.png" alt="" /></p>

<p>そして最後に，サンプリング推定値差の変動を示したのが以下の図である．glm()関数で推定した値を赤線で表示しており，そこからどれだけ離れているかを見ることができる．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> apply<span class="p">(</span>cbind<span class="p">(</span>a.est<span class="p">,</span>b.est<span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>loglik<span class="p">(</span>x<span class="p">[</span><span class="m">1</span><span class="p">],</span>x<span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="o">+</span>logq<span class="p">(</span>x<span class="p">[</span><span class="m">1</span><span class="p">],</span>x<span class="p">[</span><span class="m">2</span><span class="p">])}),</span>
</span><span class='line'>     type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iteration&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>abline<span class="p">(</span>h<span class="o">=</span><span class="p">(</span>loglik<span class="p">(</span>fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">],</span>fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="o">+</span>logq<span class="p">(</span>fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">],</span>fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">])),</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-13_4.png" alt="" /></p>

<h4>d. サンプリングで得られたパラメータの分布から，華氏60,50,40度のときの故障の確率と標準誤差を推定する</h4>

<p>サンプリングで得られた値を用いて，ある温度における故障の確率と標準誤差を求める．なお，今回はBurn-inによる推定値の切り捨てを行なっておらず，サンプリング回数5000回で得られた推定値を全て使っている．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="kr">for</span><span class="p">(</span>t in c<span class="p">(</span><span class="m">60</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">40</span><span class="p">)){</span>
</span><span class='line'>  p <span class="o">&lt;-</span> <span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span>exp<span class="p">(</span><span class="o">-</span><span class="p">(</span>a.est<span class="o">+</span>b.est<span class="o">*</span>t<span class="p">)))</span>
</span><span class='line'>  print<span class="p">(</span>paste<span class="p">(</span><span class="s">&quot;temp:&quot;</span><span class="p">,</span> t<span class="p">,</span> <span class="s">&quot;=&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;mean=&quot;</span><span class="p">,</span> round<span class="p">(</span>mean<span class="p">(</span>p<span class="p">),</span>digit<span class="o">=</span><span class="m">4</span><span class="p">),</span> <span class="s">&quot;, S.D.=&quot;</span><span class="p">,</span> round<span class="p">(</span>sd<span class="p">(</span>p<span class="p">),</span>digit<span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="p">))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;temp: 60 =&gt; mean= 0.7476 , S.D.= 0.1282&quot;</span>
</span><span class='line'><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;temp: 50 =&gt; mean= 0.9525 , S.D.= 0.0641&quot;</span>
</span><span class='line'><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;temp: 40 =&gt; mean= 0.9895 , S.D.= 0.0248&quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによる医療統計学」はRの使い方と統計解析の基礎が学べる良書（ただし入手困難）]]></title>
    <link href="http://yagays.github.com/blog/2012/11/29/review-introductory-statistics-with-r/"/>
    <updated>2012-11-29T06:18:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/29/review-introductory-statistics-with-r</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621078119" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>一般化線形モデルやロジスティックモデルなどの基本的な線形回帰を復習するために，久しぶりに本書を引っ張りだしてきてひと通り読み返した．自分としては理論や基本的な部分はある程度抑えているつもりだったけれども，検定であったり上手く回帰をするためのデータの条件であったりといった細かな部分に関しては，まだまだ不勉強なところが多い．とにかくデータに対して回帰をかけてこれで良しみたいな部分があったので，そういった部分を補うという意味でも良い復習になった．最近はMCMCにもっぱら専念しているが，基礎であったり古典の部分もしっかり抑えておかなければ…．</p>

<p>タイトルに「医療統計学」と難しそうな名前が付いている本書だが，原書のタイトルが&#8221;Introductory statistics with R&#8221;であるように，実質的には統計解析ソフトRの入門書である．例題で扱う題材として医療統計のデータが使われているだけで，内容自体に医療分野の専門性は無い．本書前半では，基本的なRの使い方とともに統計解析の基礎が説明され，後半になると，線形回帰や重回帰分析，ロジスティック回帰，生存分析などの具体的な解析手法が紹介される．全体を通して，サンプルデータを用いた豊富な解析実例とRのコード例がセットになっているため，必要ならば解析を再現することも可能である．そのため，Rを勉強するのも良し，解析手法を勉強するも良しと，初心者から中級者にかけての読者向けの非常にバランスの取れた構成となっている．また，理論よりも実戦向きの内容となっており，検定方法やモデル選択の比重が大きいのが本書の特徴でもある．そういえば，私がRを触り始めた頃は「<a href="http://www.amazon.co.jp/gp/product/4274067831/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4274067831&linkCode=as2&tag=yagays-22">The R Tips―データ解析環境Rの基本技・グラフィックス活用集</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4274067831" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」がまさにバイブルといった感じだったが，プログラミングとしてのRの解説がメインで統計解析の流れを説明した具体例は少なく，実用的な部分は本書をよく参照していた記憶がある．</p>

<p>ということで本書はR本の中でも結構オススメできる部類なのだが，どうやら<a href="http://www.amazon.co.jp/gp/product/4621078119/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4621078119&linkCode=as2&tag=yagays-22">Amazon</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4621078119" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />や<a href="http://pub.maruzen.co.jp/book_magazine/book_data/search/9784621078112.html">丸善の公式ページ</a>，<a href="http://www.junkudo.co.jp/detail.jsp?ISBN=9784621078112">丸善&amp;ジュンク堂のネットストア</a>などの主だったネット書店で品切れが相次いでいるようだ．ともなると，本書を手に入れるにはAmazonのマーケットプレイスで高い値段で買うか，大きな書店で売れ残っている本を見つけるかするしか無さそうだ．まあ今となってはRと統計に関する書籍は山ほど出版されているので，本書がこれから増刷などが掛かることは難しかもしれないが，このまま絶版になっていくには実に惜しい本だと思う．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「やっかいな放射線と向き合って暮らしていくための基礎知識 」読了]]></title>
    <link href="http://yagays.github.com/blog/2012/11/28/review-radbookbasic/"/>
    <updated>2012-11-28T00:12:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/28/review-radbookbasic</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4255006768" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>本書の元となった文章のことは前々から知っていたし，pdfファイルもPCにダウンロードしていたのだけれども，結局その文章を読むことはなかった．書店で本書が並んでいるのを見た時に「関心があるだけフリをしているだけではダメだ」と思って本書を購入し，まとまった時間を作って一気に読んだ．</p>

<p>本書はタイトルの通り，原発事故後の日本に暮らす私達が放射線とどう付き合っていけばよいかについて，科学的な知見を紹介する内容となっている．本の中で説明されるのは，放射線の基礎的な性質や放射線が生物にどのように影響を与えるのかといった仕組み，そして国際的に認められた機関が放射線と人間の関係においてどのような基準を作っているのかといった，あくまで判断材料としての基礎的な情報だ．そのため，今の生活が安心なのかそれとも危険なのかといった結論は，直接的には書かれていない．あくまで判断をするのは私達自身だという前提のもとで，できるだけ専門性は排除して初学者にも分かりやすい形で本書は構成されている．</p>

<p>本書を書かれた田崎晴明氏は，個人的には統計力学の先生というイメージが強い．分野が違うのに何故と最初は思っていたのだが，本書を読むにつれ，田崎氏の科学者として正しい情報を普及させたいという真摯な態度が伝わってきて，その理由が納得できた．非専門家でありながらも，放射線の説明は見事としか言いようがない．問題の本質をしっかりと捉え，噛み砕いた形でありながらも正確さを損なっていない．特に，放射線は化学反応とは別の次元の物理現象なのだという前提は，まさに放射線を取り巻く全ての問題のを理解する上で知っておくべき一番重要なことだろう．他にも，不正確な情報の中からいかに上限を見積もって判断材料にするかといったことも述べられており，科学的な考え方のエッセンスが詰まっている．そういった面でも非常に参考になる本であり，啓蒙書としての見本となるような文章だと感じた．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによるモンテカルロ法入門」読書ノート：6章 ランダム・ウォーク・メトロポリス・ヘイスティング・アルゴリズム]]></title>
    <link href="http://yagays.github.com/blog/2012/11/27/imcmr-6-4/"/>
    <updated>2012-11-27T06:18:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/27/imcmr-6-4</id>
    <content type="html"><![CDATA[<ul>
<li>読書ノート アーカイブ：<a href="http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/">http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>例 6.4 ランダム・ウォークのパラメータ設定によるサンプリングへの影響を，正規分布の乱数生成を例に確かめる</h3>

<p>摂動が<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_t+%5Csim+%5Cmathcal%7BU%7D_%7B%5B-%5Cdelta%2C%5Cdelta%5D%7D+" alt="\varepsilon_t \sim \mathcal{U}_{[-\delta,\delta]} " />となるようなランダム・ウォークにおいて，正規分布<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BN%7D%280%2C1%29+" alt="\mathcal{N}(0,1) " />をサンプリングするときのメトロポリス・ヘイスティング・アルゴリズムの受理確率は</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Crho%28x%5E%7B%28t%29%7D%2Cy_t%29+%3D+%5Cmin+%5Cbig%5B1%2C+%5Cexp%5C%7B%5Cfrac%7Bx%5E%7B%28t%292%7D-y_t%5E2%7D%7B2%7D+%5C%7D+%5Cbig%5D+" alt="\rho(x^{(t)},y_t) = \min \big[1, \exp{\frac{x^{(t)2}-y_t^2}{2} } \big] " /></p>

<p>で表される．</p>

<p>今回は，一様候補のパラメータを<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+0.1%2C+1%2C+10+" alt="\delta = 0.1, 1, 10 " />と変更して，メトロポリス・ヘイスティング・アルゴリズムによるローカルな探索がどういう挙動を示すのかを調べる．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfcol<span class="o">=</span>c<span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>d in c<span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">)){</span>
</span><span class='line'>  Niter <span class="o">&lt;-</span> <span class="m">2500</span>
</span><span class='line'>  x <span class="o">&lt;-</span> <span class="m">0</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>    y <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> runif<span class="p">(</span><span class="m">1</span><span class="p">,</span> min<span class="o">=-</span>d<span class="p">,</span> max<span class="o">=</span>d<span class="p">)</span>
</span><span class='line'>    <span class="kr">if</span> <span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>y<span class="o">^</span><span class="m">2</span> <span class="o">-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">))</span> <span class="p">)){</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> y
</span><span class='line'>    <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> x<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;d = &quot;</span><span class="p">,</span>d<span class="p">))</span>
</span><span class='line'>  hist<span class="p">(</span>x<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">-4</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  curve<span class="p">(</span>dnorm<span class="p">(</span>x<span class="p">),</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span><span class='line'>  acf<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>それぞれのパラメータにおける系列の変動，分布，自己相関プロットを示したのが以下の図である．それぞれのサンプリング結果を見比べてみると，</p>

<ul>
<li>一様候補のパラメータが小さい場合（<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+0.1+" alt="\delta = 0.1 " />）

<ul>
<li>ランダム・ウォークで移動する幅が狭い</li>
<li>分布が偏っている</li>
<li>自己相関が高い（前の値からあまり変わらない）</li>
</ul>
</li>
<li>一様候補のパラメータが大きい場合（<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+10+" alt="\delta = 10 " />）

<ul>
<li>ランダム・ウォークで移動する幅が大きい</li>
<li>これも同様に分布が安定しない</li>
</ul>
</li>
</ul>


<p>という結果となり，ランダム・ウォーク・メトロポリス・ヘイスティング・アルゴリズムにおいては摂動（<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_t+" alt="\varepsilon_t " />）のパラメータ設定が重要であることがわかる．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-4.png" alt="" /></p>

<h3>例 6.10 ランダム・ウォーク・メトロポリス・ヘイスティング・アルゴリズムの受理率を調べる</h3>

<p>メトロポリス・ヘイスティング・アルゴリズムにおけるアルゴリズム効率化の調整は，本書の2章で扱った受理・棄却アルゴリズムの時の最大受理率に基づいた調整の場合とは異なる．まず，上の例 6.4で示した正規分布からのサンプリングにおける受理率を見てみる．パラメータごとの受理率は以下のようになった（Rのコードは省略）．</p>

<ul>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+0.1+" alt="\delta = 0.1 " />：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=r+%3D+0.9792+" alt="r = 0.9792 " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+1+" alt="\delta = 1 " />：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=r+%3D+0.8132+" alt="r = 0.8132 " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+%3D+10+" alt="\delta = 10 " />：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=r+%3D+0.1716+" alt="r = 0.1716 " /></li>
</ul>


<p>この結果から，受理率が高ければサンプリングの結果も良くなるわけではないことがわかる．このことから，ランダム・ウォーク・メトロポリス・ヘイスティング・アルゴリズムにおいては，受理率を高めるようにアルゴリズムを調節してはいけないと判断できる．このアルゴリズムにおいて，どのような受理率を取ればよいかといった疑問に関しては，以下の練習問題6.14のc.で詳しく見ていく．</p>

<br />


<h3>練習問題 6.14 ランダム・ウォーク候補がサンプリング結果に与える影響について，複数の候補分布を用いてより詳細に調べる</h3>

<h4>a. P.205の図6.7を再現する</h4>

<p>図6.7の再現と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cdelta+" alt="\delta " />の解釈は，上の例6.4の解答を参考．</p>

<h4>b. コーシー候補とラプラス候補を検討する</h4>

<p>今度は，一様分布の代わりにコーシー分布やラプラス分布を候補分布として使った場合の，ランダム・ウォーク・メトロポリス・ヘイスティング・アルゴリズムの挙動を調べる．</p>

<h4>コーシー候補</h4>

<p>ランダム・ウォーク候補は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_t+%5Csim+%5Cmathcal%7BC%7D%28x_0%2C%5Cgamma%29+" alt="\varepsilon_t \sim \mathcal{C}(x_0,\gamma) " />とし，コーシー分布のパラメータは<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x_0+%3D+0+" alt="x_0 = 0 " />，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cgamma+%3D+0.01%2C%5C+1%2C%5C+10+" alt="\gamma = 0.01,\ 1,\ 10 " />を考える．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># Cauchy candidate</span>
</span><span class='line'>par<span class="p">(</span>mfcol<span class="o">=</span>c<span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>g in c<span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">)){</span>
</span><span class='line'>  Niter <span class="o">&lt;-</span> <span class="m">2500</span>
</span><span class='line'>  x <span class="o">&lt;-</span> <span class="m">0</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>    y <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> rcauchy<span class="p">(</span><span class="m">1</span><span class="p">,</span> location<span class="o">=</span><span class="m">0</span><span class="p">,</span> scale<span class="o">=</span>g<span class="p">)</span>
</span><span class='line'>    <span class="kr">if</span> <span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>y<span class="o">^</span><span class="m">2</span> <span class="o">-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">))</span> <span class="p">)){</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> y
</span><span class='line'>    <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> x<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;Cauchy candidate,&quot;</span><span class="p">,</span><span class="s">&quot;gamma=&quot;</span><span class="p">,</span>g<span class="p">))</span>
</span><span class='line'>  hist<span class="p">(</span>x<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">-4</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  curve<span class="p">(</span>dnorm<span class="p">(</span>x<span class="p">),</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span><span class='line'>  acf<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-14_1.png" alt="" /></p>

<h4>ラプラス候補</h4>

<p>ランダム・ウォーク候補は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_t+%5Csim+%5Cmathcal%7BL%7D%28%5Cmu%2Cb%29+" alt="\varepsilon_t \sim \mathcal{L}(\mu,b) " />とし，ラプラス分布のパラメータは<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmu%3D0+" alt="\mu=0 " />，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=b+%3D+0.1%2C%5C+1%2C%5C+10+" alt="b = 0.1,\ 1,\ 10 " />を考える．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># Laplace candidate</span>
</span><span class='line'>par<span class="p">(</span>mfcol<span class="o">=</span>c<span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>a in c<span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">)){</span>
</span><span class='line'>  Niter <span class="o">&lt;-</span> <span class="m">2500</span>
</span><span class='line'>  x <span class="o">&lt;-</span> <span class="m">0</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>    y <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> ifelse<span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&gt;</span><span class="m">0.5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">-1</span><span class="p">)</span><span class="o">*</span>rexp<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">/</span>a
</span><span class='line'>    <span class="kr">if</span> <span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>y<span class="o">^</span><span class="m">2</span> <span class="o">-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">))</span> <span class="p">)){</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> y
</span><span class='line'>    <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> x<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;Laplace candidate,&quot;</span><span class="p">,</span><span class="s">&quot;b=&quot;</span><span class="p">,</span>a<span class="p">))</span>
</span><span class='line'>  hist<span class="p">(</span>x<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">-4</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  curve<span class="p">(</span>dnorm<span class="p">(</span>x<span class="p">),</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span><span class='line'>  acf<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-14_2.png" alt="" /></p>

<p>以上の結果から，コーシー候補やラプラス候補においても，ランダム・ウォークの値の取り方によって適切なサンプリングができるかどうかが決まってくることがわかる．また，どちらも自己相関が低い値の時にサンプリング結果が一番良いことが見て取れる．これは例6.4の一様候補の場合とは違う結果となったが，恐らくコーシー分布やラプラス分布はともに一峰型の正規分布のような形であることが効いていて，ランダム・ウォークの移動が適度に調節されているからだろう．</p>

<h4>c. パラメータの調節により受理確率を0.25に近づける</h4>

<p>さて，例6.10で述べたように，ランダム・ウォークを使ったメトロポリス・ヘイスティング・アルゴリズムにおいては，受理率の最大化がアルゴリズムの効率化に繋がらないことがわかった．受理率はどれくらいを目安にすればよいかという疑問に関しては，本書では「高次元では0.25，低次元では0.5程度」というRoberts et al.(2007)の提案を引用している．そこで，先ほどの3つのランダム・ウォーク候補について受理率を0.25に近づけるために，パラメータの値を0から10まで0.1刻みで設定したときの，一様候補・コーシー候補・ラプラス候補を用いたアルゴリズムにおける受理率の変化を以下の図でプロットした．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-14_3.png" alt="" /></p>

<p>赤の点線は受理率0.25を表している．この図を見ると，一様候補とコーシー候補はパラメータの値が大きくなるにつれて受理率も小さくなり，逆にラプラス候補の場合ではパラメータの値が大きくなるにつれて受理率は大きくなることがわかる．いずれの場合においても，受理率を0.25に近づけることは可能である．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac OS XでJAGS＆rjagsパッケージを動かす]]></title>
    <link href="http://yagays.github.com/blog/2012/11/26/rjags-on-mac-os-x/"/>
    <updated>2012-11-26T07:18:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/26/rjags-on-mac-os-x</id>
    <content type="html"><![CDATA[<h3>MacPortsでJAGSを入れる場合はちょっと注意</h3>

<p>MacでJAGSをインストールする場合，</p>

<ul>
<li><a href="http://sourceforge.net/projects/mcmc-jags/">SourceForge</a>からパッケージをダウンロードしてインストールする方法</li>
<li><a href="https://trac.macports.org/browser/trunk/dports/science/jags/Portfile">MacPorts</a>を使ってインストールする方法</li>
</ul>


<p>の2通りがある．どちらで入れてもJAGS自体に違いはないのだが，Rのrjagsパッケージをインストールする際に少し注意しなければいけないポイントがある．1つ目の方法でパッケージからインストールした場合だと，いつも通りに</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># パッケージからインストールした場合</span>
</span><span class='line'><span class="o">&gt;</span> install.packages<span class="p">(</span><span class="s">&quot;rjags&quot;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> library<span class="p">(</span>rjags<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>とすれば良いのだが，MacPortsでインストールした場合では，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># MacPortsからインストールした場合</span>
</span><span class='line'><span class="o">&gt;</span> install.packages<span class="p">(</span><span class="s">&quot;rjags&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;source&quot;</span><span class="p">,</span> configure.args <span class="o">=</span> <span class="s">&#39;--with-jags-lib=/opt/local/lib --with-jags-include=/opt/local/include/JAGS --with-jags-modules=/opt/local/lib/JAGS/modules-3&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> library<span class="p">(</span>rjags<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>のように，パッケージのインストールの際に色々とオプションを付ける必要がある．というのも，パッケージからインストールした場合では/usr/local/以下にインストールされるのに対し，MacPortsからインストールした場合では/opt/local/以下にインストールされるからだ．Rでrjagsパッケージをインストールする際には，どうやら/usr/local/以下のモジュールや共有ライブラリを参照するようなので，MacPortsで入れた場合にはそもそもディレクトリが違うためファイルが見つからないといったエラーが出る．</p>

<h3>他の解決方法</h3>

<p>ちなみに，/usr/local/lib以下にシンボリックリンクを貼って強引に解決する方法もある．自分は最初こちらで対処していたのだが，長期的に考えた場合にJAGSのバージョンアップによってdylibの名前が変わる可能性などもあるので，上のようにパッケージのインストールの段階で対処する方が良いだろう．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /usr/local/lib
</span><span class='line'><span class="nv">$ </span>sudo ln -s /opt/local/lib/libjags.3.dylib .
</span><span class='line'><span class="nv">$ </span>sudo ln -s /opt/local/lib/JAGS .
</span></code></pre></td></tr></table></div></figure>


<h3>参考：MacPortsの場合でinstall.package(&#8220;rjags&#8221;)で入れてしまったときのrjags読み込み時のエラー</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> library<span class="p">(</span>rjags<span class="p">)</span>
</span><span class='line'> 要求されたパッケージ coda をロード中です
</span><span class='line'> 要求されたパッケージ lattice をロード中です
</span><span class='line'>Error :  <span class="m">.</span>onLoadはloadNamespace<span class="p">()</span>（rjagsに対する）の中で失敗しました、詳細は:
</span><span class='line'> call: dyn.load<span class="p">(</span>file<span class="p">,</span> DLLpath <span class="o">=</span> DLLpath<span class="p">,</span> <span class="m">...</span><span class="p">)</span>
</span><span class='line'> error:  共有ライブラリ <span class="s">&#39;/Library/Frameworks/R.framework/Versions/2.15/Resources/library/rjags/libs/x86_64/rjags.so&#39;</span> を読み込めません：
</span><span class='line'>  dlopen<span class="p">(</span><span class="o">/</span>Library<span class="o">/</span>Frameworks<span class="o">/</span>R.framework<span class="o">/</span>Versions<span class="o">/</span><span class="m">2.15</span><span class="o">/</span>Resources<span class="o">/</span>library<span class="o">/</span>rjags<span class="o">/</span>libs<span class="o">/</span>x86_64<span class="o">/</span>rjags.so<span class="p">,</span> <span class="m">10</span><span class="p">)</span>: Library not loaded: <span class="o">/</span>usr<span class="o">/</span>local<span class="o">/</span>lib<span class="o">/</span>libjags.3.dylib
</span><span class='line'>  Referenced from: <span class="o">/</span>Library<span class="o">/</span>Frameworks<span class="o">/</span>R.framework<span class="o">/</span>Versions<span class="o">/</span><span class="m">2.15</span><span class="o">/</span>Resources<span class="o">/</span>library<span class="o">/</span>rjags<span class="o">/</span>libs<span class="o">/</span>x86_64<span class="o">/</span>rjags.so
</span><span class='line'>  Reason: image not found
</span><span class='line'> エラー：  <span class="s">&#39;‘rjags’&#39;</span> に対するパッケージもしくは名前空間のロードが失敗しました
</span></code></pre></td></tr></table></div></figure>


<h3>実行環境</h3>

<ul>
<li>Mac OS X 10.8.2</li>
<li>R version 2.15.1</li>
<li>JAGS 3.3.0</li>
<li>rjags version 3-7</li>
</ul>


<h3>参考</h3>

<ul>
<li><a href="http://mcmc-jags.sourceforge.net/">JAGS - Just Another Gibbs Sampler</a></li>
<li><a href="http://cran.r-project.org/web/packages/rjags/index.html">CRAN - Package rjags</a></li>
<li><a href="http://eity.que.jp/pukiwiki/index.php?BUGS">Eity&#8217;s Web - BUGS</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによるモンテカルロ法入門」読書ノート：6章 メトロポリス・ヘイスティング・アルゴリズム その2]]></title>
    <link href="http://yagays.github.com/blog/2012/11/25/imcmr-6-3/"/>
    <updated>2012-11-25T01:28:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/25/imcmr-6-3</id>
    <content type="html"><![CDATA[<ul>
<li>読書ノート アーカイブ：<a href="http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/">http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>例 6.3 二次モデルの線形回帰におけるパラメータの事後分布から，メトロポリス・ヘイスティング・アルゴリズムを用いてサンプリングする</h3>

<p>この例題では，carsのデータセットにおいて線形回帰による二次曲線のあてはめをおこない，最尤法で推定したパラメータによる事後分布から複数のサンプリングを行うことを目標にする．今回使用するデータセットは車の速度とその時の制動距離に関するデータで，Rの入門書でよく例に使われるものである．carsのデータセットに関するHelpのExampleには，本問題と似たようなプロットを描写するコード例が載っている．</p>

<p>この問題では，車のスピード<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x+" alt="x " />と制動距離<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=y+" alt="y " />の関係について，以下式で表される二次モデルで線形回帰をおこなう．</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=y_%7Bij%7D%3Da%2Bbx_i%2Bcx_i%5E2%2B%5Cvarepsilon_%7Bij%7D+" alt="y_{ij}=a+bx_i+cx_i^2+\varepsilon_{ij} " /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>data<span class="p">(</span>cars<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>y <span class="o">&lt;-</span> cars<span class="p">$</span>dist
</span><span class='line'>x <span class="o">&lt;-</span> cars<span class="p">$</span>speed
</span><span class='line'>x2 <span class="o">&lt;-</span> x<span class="o">^</span><span class="m">2</span>
</span><span class='line'>fit <span class="o">&lt;-</span> lm<span class="p">(</span>y ~ x <span class="o">+</span> x2<span class="p">)</span>
</span><span class='line'>s <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">25</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
</span><span class='line'>yhat <span class="o">&lt;-</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span>s <span class="o">+</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span>s<span class="o">^</span><span class="m">2</span>
</span><span class='line'>
</span><span class='line'>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">120</span><span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;dist&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;data(cars)&quot;</span><span class="p">)</span>
</span><span class='line'>lines<span class="p">(</span>s<span class="p">,</span> yhat<span class="p">,</span> lwd<span class="o">=</span><span class="m">4</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>以下の図は，車のスピードをx軸に，制動距離をy軸に取って，carsに含まれる50個のデータをプロットし，オレンジの線で回帰直線を表示している．また，この時の線形回帰で求められた各パラメータの推定値をsummary()関数を用いて表示している．この情報から，それぞれのパラメータの推定値は</p>

<ul>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=a+%3D+2.47014+" alt="a = 2.47014 " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=b+%3D+0.91329+" alt="b = 0.91329 " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c+%3D+0.09996+" alt="c = 0.09996 " /></li>
</ul>


<p>ということがわかる．次の練習問題 6.11では，この推定値を元に，事後分布のサンプリングをメトロポリス・ヘイスティング・アルゴリズムで行う．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-11_1.png" alt="" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> summary<span class="p">(</span>fit<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>Call:
</span><span class='line'>lm<span class="p">(</span>formula <span class="o">=</span> y ~ x <span class="o">+</span> x2<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>Residuals:
</span><span class='line'>    Min      <span class="m">1</span>Q  Median      <span class="m">3</span>Q     Max
</span><span class='line'><span class="m">-28.720</span>  <span class="m">-9.184</span>  <span class="m">-3.188</span>   <span class="m">4.628</span>  <span class="m">45.152</span>
</span><span class='line'>
</span><span class='line'>Coefficients:
</span><span class='line'>            Estimate Std. Error t value Pr<span class="p">(</span><span class="o">&gt;|</span>t<span class="o">|</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span>Intercept<span class="p">)</span>  <span class="m">2.47014</span>   <span class="m">14.81716</span>   <span class="m">0.167</span>    <span class="m">0.868</span>
</span><span class='line'>x            <span class="m">0.91329</span>    <span class="m">2.03422</span>   <span class="m">0.449</span>    <span class="m">0.656</span>
</span><span class='line'>x2           <span class="m">0.09996</span>    <span class="m">0.06597</span>   <span class="m">1.515</span>    <span class="m">0.136</span>
</span><span class='line'>
</span><span class='line'>Residual standard error: <span class="m">15.18</span> on <span class="m">47</span> degrees of freedom
</span><span class='line'>Multiple R<span class="o">-</span>squared: <span class="m">0.6673</span><span class="p">,</span>  Adjusted R<span class="o">-</span>squared: <span class="m">0.6532</span>
</span><span class='line'><span class="k-Variable">F</span><span class="o">-</span>statistic: <span class="m">47.14</span> on <span class="m">2</span> and <span class="m">47</span> DF<span class="p">,</span>  p<span class="o">-</span>value: <span class="m">5.852</span>e<span class="o">-</span><span class="m">12</span>
</span></code></pre></td></tr></table></div></figure>


<h3>練習問題 6.11 メトロポリス・ヘイスティング・アルゴリズムを用いて事後分布からのサンプリングをする（例6.3の続き）</h3>

<h4>a. P.202の図6.6を描写する</h4>

<p>ここで<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_%7Bij%7D+%5Csim+%5Cmathcal%7BN%7D%280%2C%5Csigma%5E2%29+" alt="\varepsilon_{ij} \sim \mathcal{N}(0,\sigma^2) " />とすると，この時の尤度関数は以下式のように表される．</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=p%28y_%7Bij%7D%7Cx_i%2Ca%2Cb%2Cc%2C%5Csigma%5E2%29+%3D+%5Cprod_%7Bij%7D+%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%5Csigma%5E2%7D%7D%5Cexp%28-%5Cfrac%7B%28y_%7Bij%7D-a-bx_i-cx_i%5E2%29%5E2%7D%7B2%5Csigma%5E2%7D%29+" alt="p(y_{ij}|x_i,a,b,c,\sigma^2) = \prod_{ij} \frac{1}{\sqrt{2\pi\sigma^2}}\exp(-\frac{(y_{ij}-a-bx_i-cx_i^2)^2}{2\sigma^2}) " /></p>

<p>これを整理すると．</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=p%28y_%7Bij%7D%7Cx_i%2Ca%2Cb%2Cc%2C%5Csigma%5E2%29+%5Csim+%5Cbigg%28+%5Cfrac%7B1%7D%7B%5Csqrt%7B%5Csigma%5E2%7D%7D+%5Cbigg%29%5EN+%5Cexp%7B%28-%5Cfrac%7B-1%7D%7B2%5Csigma%5E2%7D+%5Csum_%7Bij%7D%28y_%7Bij%7D-a-bx_i-cx_%7Bij%7D%29%5E2+%29%7D+" alt="p(y_{ij}|x_i,a,b,c,\sigma^2) \sim \bigg( \frac{1}{\sqrt{\sigma^2}} \bigg)^N \exp{(-\frac{-1}{2\sigma^2} \sum_{ij}(y_{ij}-a-bx_i-cx_{ij})^2 )} " /></p>

<p>となる．この尤度関数を<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=x_i%2Ca%2Cb%2Cc%2C%5Csigma%5E2+" alt="x_i,a,b,c,\sigma^2 " />による事後分布とみなす．それぞれのパラメータの分布は，先ほどの線形回帰で求めた推定値と標準誤差を用いる．</p>

<ul>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=a+%5Csim+%5Cmathcal%7BN%7D%282.47%2C+%2814.8%29%5E2%29+" alt="a \sim \mathcal{N}(2.47, (14.8)^2) " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=b+%5Csim+%5Cmathcal%7BN%7D%280.913%2C+%282.03%29%5E2%29+" alt="b \sim \mathcal{N}(0.913, (2.03)^2) " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c+%5Csim+%5Cmathcal%7BN%7D%280.100%2C+%281.52%29%5E2%29+" alt="c \sim \mathcal{N}(0.100, (1.52)^2) " /></li>
<li><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Csigma%5E%7B-2%7D+%5Csim+%5Cmathcal%7BG%7D%28n%2F2%2C+%28n-3%29%2815.18%29%5E2%29+" alt="\sigma^{-2} \sim \mathcal{G}(n/2, (n-3)(15.18)^2) " /></li>
</ul>


<p>なお，上の推定値や標準誤差は本書に例示されている値と若干異なっているが，今回は自分の計算環境で計算した推定値を用いることにした．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># 例6.3での線形回帰</span>
</span><span class='line'>data<span class="p">(</span>cars<span class="p">)</span>
</span><span class='line'>y <span class="o">&lt;-</span> cars<span class="p">$</span>dist
</span><span class='line'>x <span class="o">&lt;-</span> cars<span class="p">$</span>speed
</span><span class='line'>x2 <span class="o">&lt;-</span> x<span class="o">^</span><span class="m">2</span>
</span><span class='line'>fit <span class="o">&lt;-</span> lm<span class="p">(</span>y ~ x <span class="o">+</span> x2<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>loglik <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">,</span>c<span class="p">,</span>sigma<span class="p">){</span><span class="o">-</span><span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span>log<span class="p">(</span>sigma<span class="p">)</span><span class="o">-</span>sum<span class="p">((</span>y<span class="o">-</span>a<span class="o">-</span>b<span class="o">*</span>x<span class="o">-</span>c<span class="o">*</span>x2<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span>sigma<span class="p">)}</span>
</span><span class='line'>logq <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">,</span>c<span class="p">,</span>sigma<span class="p">){</span>
</span><span class='line'>  dnorm<span class="p">(</span>a<span class="p">,</span>mean<span class="o">=</span>a.est<span class="p">[</span><span class="m">1</span><span class="p">],</span>sd<span class="o">=</span>a.std<span class="p">,</span>log<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>
</span><span class='line'>  <span class="o">+</span> dnorm<span class="p">(</span>b<span class="p">,</span>mean<span class="o">=</span>b.est<span class="p">[</span><span class="m">1</span><span class="p">],</span>sd<span class="o">=</span>b.std<span class="p">,</span>log<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>
</span><span class='line'>  <span class="o">+</span> dnorm<span class="p">(</span>c<span class="p">,</span>mean<span class="o">=</span>c.est<span class="p">[</span><span class="m">1</span><span class="p">],</span>sd<span class="o">=</span>c.std<span class="p">,</span>log<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span>log<span class="p">(</span>sigma<span class="p">)</span> <span class="o">-</span> <span class="p">(</span>n<span class="o">-</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">15.18</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span>sigma<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>Niter <span class="o">&lt;-</span> <span class="m">4000</span>
</span><span class='line'>n <span class="o">&lt;-</span> length<span class="p">(</span>x<span class="p">)</span>
</span><span class='line'>fit.param <span class="o">&lt;-</span> summary<span class="p">(</span>fit<span class="p">)$</span>coef
</span><span class='line'>a.est <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>a.std <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>b.est <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>b.std <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>c.est <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>c.std <span class="o">&lt;-</span> fit.param<span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>sig <span class="o">&lt;-</span> <span class="m">1</span><span class="o">/</span>rgamma<span class="p">(</span><span class="m">1</span><span class="p">,</span> n<span class="o">/</span><span class="m">2</span><span class="p">,</span> rate<span class="o">=</span><span class="p">(</span>n<span class="o">-</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">15.18</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>  candidate <span class="o">&lt;-</span> c<span class="p">(</span>rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span>a.est<span class="p">[</span><span class="m">1</span><span class="p">],</span> sd<span class="o">=</span>a.std<span class="p">),</span>
</span><span class='line'>                 rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span>b.est<span class="p">[</span><span class="m">1</span><span class="p">],</span> sd<span class="o">=</span>b.std<span class="p">),</span>
</span><span class='line'>                 rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span>c.est<span class="p">[</span><span class="m">1</span><span class="p">],</span> sd<span class="o">=</span>c.std<span class="p">),</span>
</span><span class='line'>                 <span class="m">1</span><span class="o">/</span>rgamma<span class="p">(</span><span class="m">1</span><span class="p">,</span> n<span class="o">/</span><span class="m">2</span><span class="p">,</span> rate<span class="o">=</span><span class="p">(</span>n<span class="o">-</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">15.18</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">)</span>
</span><span class='line'>  fy <span class="o">&lt;-</span> loglik<span class="p">(</span>candidate<span class="p">[</span><span class="m">1</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">3</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">4</span><span class="p">])</span>
</span><span class='line'>  fx <span class="o">&lt;-</span> loglik<span class="p">(</span>a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> c.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> sig<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])</span>
</span><span class='line'>  qxy <span class="o">&lt;-</span> logq<span class="p">(</span>a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> c.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> sig<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])</span>
</span><span class='line'>  qyx <span class="o">&lt;-</span> logq<span class="p">(</span>candidate<span class="p">[</span><span class="m">1</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">3</span><span class="p">],</span> candidate<span class="p">[</span><span class="m">4</span><span class="p">])</span>
</span><span class='line'>  rho <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span>fy<span class="o">-</span>fx<span class="o">+</span>qxy<span class="o">-</span>qyx<span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">if</span> <span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&lt;</span>rho<span class="p">){</span>
</span><span class='line'>    a.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    b.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">2</span><span class="p">]</span>
</span><span class='line'>    c.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">3</span><span class="p">]</span>
</span><span class='line'>    sig<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> candidate<span class="p">[</span><span class="m">4</span><span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>    a.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> a.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    b.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> b.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    c.est<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> c.est<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    sig<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> sig<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>s <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">25</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
</span><span class='line'>yhat <span class="o">&lt;-</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span>s <span class="o">+</span> fit<span class="p">$</span>coef<span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span>s<span class="o">^</span><span class="m">2</span>
</span><span class='line'>
</span><span class='line'>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">120</span><span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;dist&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;data(cars)&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="p">(</span>Niter<span class="o">-</span><span class="m">500</span><span class="p">)</span>:Niter<span class="p">){</span>
</span><span class='line'>  lines<span class="p">(</span>x<span class="p">,</span> a.est<span class="p">[</span>i<span class="p">]</span><span class="o">+</span>b.est<span class="p">[</span>i<span class="p">]</span><span class="o">*</span>x<span class="o">+</span>c.est<span class="p">[</span>i<span class="p">]</span><span class="o">*</span>x2<span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;grey&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>lines<span class="p">(</span>s<span class="p">,</span> yhat<span class="p">,</span> lwd<span class="o">=</span><span class="m">4</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">)</span>
</span><span class='line'>points<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>以下の図は，先ほどの線形回帰のプロットに加えて，サンプリングから得られた値を用いて回帰曲線を灰色の曲線として描写したものである．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-11_3.png" alt="" /></p>

<h4>b. 各パラメータの収束をモニタリングする</h4>

<p>先ほどのサンプリング結果を，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=a%2Cb%2Cc%2C%5Csigma%5E2+" alt="a,b,c,\sigma^2 " />について，4000回のシミュレーションで生成された系列と，そのときの自己相関プロット，そして系列の分布をプロットした．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> a.est<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'>acf<span class="p">(</span>a.est<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>a.est<span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> b.est<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
</span><span class='line'>acf<span class="p">(</span>b.est<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>b.est<span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> c.est<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
</span><span class='line'>acf<span class="p">(</span>c.est<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>c.est<span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Niter<span class="p">,</span> sig<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span>expression<span class="p">(</span>sigma<span class="o">^</span><span class="m">2</span><span class="p">))</span>
</span><span class='line'>acf<span class="p">(</span>sig<span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>sig<span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-11_2.png" alt="" /></p>

<h4>c. 95%信用区間を求める</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> quantile<span class="p">(</span>a.est<span class="p">,</span> c<span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="m">0.975</span><span class="p">))</span>
</span><span class='line'>     <span class="m">2.5</span><span class="o">%</span>     <span class="m">97.5</span><span class="o">%</span>
</span><span class='line'><span class="m">-14.90933</span>  <span class="m">18.98784</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「N次元の単位球の体積は5次元で最大になる」をRで試してみた]]></title>
    <link href="http://yagays.github.com/blog/2012/11/24/mcmc-n-dimentional-unit-ball/"/>
    <updated>2012-11-24T00:20:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/24/mcmc-n-dimentional-unit-ball</id>
    <content type="html"><![CDATA[<p>先日の<a href="http://live.nicovideo.jp/watch/lv115119412">伊庭さんのニコ生MCMC講義</a>の中で出てきた「N次元の単位球の体積は5次元で最大になる」というのをRで試してみた．</p>

<h3>体積</h3>

<p>N次元の単位球の体積は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=V_n+%3D+%5Cfrac%7B%5Cpi%5E%7Bn%2F2%7D%7D%7B%5CGamma%281%2Bn%2F2%29%7D+" alt="V_n = \frac{\pi^{n/2}}{\Gamma(1+n/2)} " />で表される．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>plot<span class="p">(</span>apply<span class="p">(</span>matrix<span class="p">(</span>seq<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">15</span><span class="p">)),</span><span class="m">1</span><span class="p">,</span><span class="kr">function</span><span class="p">(</span>n<span class="p">){</span>pi<span class="o">^</span><span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">/</span>gamma<span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="o">+</span><span class="m">1</span><span class="p">)}),</span>type<span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;N dimension&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;V&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Volume of the unit ball in N dimensions&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/iba_1.png" alt="" /></p>

<p>たしかに5次元で最大になっている．もはや想像が出来無い…．</p>

<h3>表面積</h3>

<p>ちなみに，単位球の表面積は7次元で最大になる．（<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=A_n+%3D+nV_n+%3D+%5Cfrac%7B2%5Cpi%5E%7Bn%2F2%7D%7D%7B%5CGamma%28n%2F2%29%7D+" alt="A_n = nV_n = \frac{2\pi^{n/2}}{\Gamma(n/2)} " />）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>plot<span class="p">(</span>apply<span class="p">(</span>matrix<span class="p">(</span>seq<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">15</span><span class="p">)),</span><span class="m">1</span><span class="p">,</span><span class="kr">function</span><span class="p">(</span>n<span class="p">){</span><span class="m">2</span><span class="o">*</span>pi<span class="o">^</span><span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">/</span>gamma<span class="p">(</span>n<span class="o">/</span><span class="m">2</span><span class="p">)}),</span>type<span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;N dimension&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;A&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Surface area of the unit ball in N dimensions&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/iba_2.png" alt="" /></p>

<h3>参考</h3>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Unit_sphere">Unit sphere - Wikipedia, the free encyclopedia</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Software Design 2012年 12月号」読了]]></title>
    <link href="http://yagays.github.com/blog/2012/11/23/review-softwaredesign-2012-12/"/>
    <updated>2012-11-23T02:32:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/23/review-softwaredesign-2012-12</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B009YK3U3Q" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>最近Blogで継続的に記事を書くようになって，自分の書く文章について特に意識するようになった．書評なり読書ノートを1つの記事をしてまとめるにあたり，とにかく文章を書いては読みを繰り返し，記事を公開したあとも電車の中で読み返すなどして誤字脱字を訂正したり推敲を重ねている．自分のBlogの一番の読者は，まぎれもなく自分だ．いったい誰のために/何のために書いているかという問題は自分の中でもハッキリしていないが，色んなことを差し置いても，結局まわりまわって自分のために書き貯めている部分は大きい．</p>

<p>文章の書き方は今でもよくわからない．ある程度まとまった記事を書くのに慣れてきた面もあり，逆にあまり代わり映えしない表現力に萎えることもある．色々と本を読んで参考にしたり，尊敬する人物の書いた文章を写経したこともあったけれども，結局血肉となったかはよくわからない．本来ならば人に添削してもらうのが一番良いのだが，特に独創性であったり主義主張があるわけではないただのBlog記事にそこまでできるはずもなく，今のところ自分でなんとか改善を繰り返している．</p>

<p>ということで，今月のSoftware Designの特集はエンジニアのための文章力養成講座だ．製品の紹介文やマニュアルなどの文章の書き方であったり，情報をいかに整理して文章を構成していくかといったテクニックが載っている．エンジニア出身のブロガーが文章力について書いているコラムでは，文章を書く人間が普段どういうことを思いながら書いているのかということが色々と書かれていて，なかなかに興味深かった．何かを主張したり情報を広めたり布教をしたりと，アウトプットの質を高めていくにはとにかく書き続けるしかないということで，これからも引き続きblogを続けていこうというモチベーションに繋がる記事だった．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによるモンテカルロ法入門」読書ノート：6章 マルコフ連鎖とランダム・ウォーク]]></title>
    <link href="http://yagays.github.com/blog/2012/11/22/imcmr-6-2/"/>
    <updated>2012-11-22T12:14:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/22/imcmr-6-2</id>
    <content type="html"><![CDATA[<ul>
<li>読書ノート アーカイブ：<a href="http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/">http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>練習問題 6.1 自己回帰モデルAR(1)が定常分布を持つことを実験的に示す</h3>

<p>この問題はいわゆるAR(1)というもので，本書の1章 P.34に同様のコードおよび作図が載っている．なお，本問題の詳細は<a href="http://www.stat.ufl.edu/~casella/ShortCourse/MCMC-UseR.pdf">MCMC-UseR.pdf</a>のP.130を参照．</p>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=X%5E%7B%28t%2B1%29%7D+%3D+%5Crho+X%5E%7B%28t%29%7D%2B%5Cvarepsilon_t+" alt="X^{(t+1)} = \rho X^{(t)}+\varepsilon_t " />，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cvarepsilon_t+%5Csim+%5Cmathcal%7BN%7D%280%2C1%29+" alt="\varepsilon_t \sim \mathcal{N}(0,1) " />で定義されるマルコフ連鎖において，系列<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5C%7BX%5E%7B%28t%29%7D%5C%7D+" alt="{X^{(t)}} " />の定常分布は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BN%7D%280%2C+%5Cfrac%7B%5Csigma%5E2%7D%7B1-%5Crho%5E2%7D%29+" alt="\mathcal{N}(0, \frac{\sigma^2}{1-\rho^2}) " />で表される．今回は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D10%5E4+" alt="t=10^4 " />までのシミュレーション結果をヒストグラムとしてプロットし，定常分布を赤い曲線で示した．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>rho <span class="o">&lt;-</span> <span class="m">0.9</span>
</span><span class='line'>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:<span class="m">10</span><span class="o">^</span><span class="m">4</span><span class="p">){</span>
</span><span class='line'>  x<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">*</span>rho <span class="o">+</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>hist<span class="p">(</span>x<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">)</span>
</span><span class='line'>curve<span class="p">(</span>dnorm<span class="p">(</span>x<span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span><span class="p">(</span><span class="m">1</span><span class="o">/</span>sqrt<span class="p">(</span><span class="m">1</span><span class="o">-</span>rho<span class="o">^</span><span class="m">2</span><span class="p">))),</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6_1.png" alt="" /></p>

<h3>練習問題 6.2 ランダム・ウォークが定常分布を持たないことを実験的に示す</h3>

<p><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=X%5E%7B%28t%2B1%29%7D%3DX%5E%7B%28t%29%7D%2B%5Cvarepsilon_t+" alt="X^{(t+1)}=X^{(t)}+\varepsilon_t " />で表されるランダム・ウォークが，シミュレーション回数を増やしても定常分布に収束しないことを実験的に確かめる．今回は初期値<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=X%5E%7B%280%29%7D%3D0+" alt="X^{(0)}=0 " />として，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D10%5E4+" alt="t=10^4 " />と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D10%5E6+" alt="t=10^6 " />までマルコフ連鎖をシミュレートする．
この問題は練習問題6.1における<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Crho+%3D+1" alt="\rho = 1" />の場合と同じになるので，上で書いたコードのパラメータを変更するだけで再現できる．ただ，今回は別の書き方としてcumsum()関数を用いてランダム・ウォークの系列を計算している．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>init <span class="o">&lt;-</span> <span class="m">0</span>
</span><span class='line'>x1 <span class="o">&lt;-</span> cumsum<span class="p">(</span>rnorm<span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="m">4</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
</span><span class='line'>x2 <span class="o">&lt;-</span> cumsum<span class="p">(</span>rnorm<span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="m">6</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
</span><span class='line'>hist<span class="p">(</span>x1<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;t=10^4&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:<span class="m">10</span><span class="o">^</span><span class="m">4</span><span class="p">,</span> c<span class="p">(</span>init<span class="p">,</span>x1<span class="p">),</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;t=10^4&quot;</span><span class="p">)</span>
</span><span class='line'>hist<span class="p">(</span>x2<span class="p">,</span> nclass<span class="o">=</span><span class="m">150</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;t=10^6&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:<span class="m">10</span><span class="o">^</span><span class="m">6</span><span class="p">,</span> c<span class="p">(</span>init<span class="p">,</span>x2<span class="p">),</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;t=10^6&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6_2.png" alt="" /></p>

<p>シミュレーション回数を<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D10%5E4+" alt="t=10^4 " />と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D10%5E6+" alt="t=10^6 " />としてランダム・ウォークを実行した結果が上図である．左図に系列のヒストグラム，右図に試行回数を横軸に取った系列をプロットしている．上のように図示すると，たとえ10<sup>6</sup> 回試行したとしても何らかの分布に収束しないことがわかる．</p>

<h3>雑感</h3>

<p>練習問題 6.1と練習問題6.2を比較すると，ランダム・ウォークにおいて先行する状態に<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=0+%5Cleq+%5Crho+%3C+1+" alt="0 \leq \rho &lt; 1 " />のような値を掛け合わせるだけで定常分布を取るというのは，なんとも面白い結果となっている．</p>

<h3>補足：<a href="http://www.stat.ufl.edu/~casella/ShortCourse/MCMC-UseR.pdf">MCMC-UseR.pdf</a>のP.132</h3>

<ul>
<li>練習問題の<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Crho+" alt="\rho " />と以下図の<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Ctheta+" alt="\theta " />は同じ</li>
<li>pdfにも書いてあるがスケール（x軸とy軸の描写範囲）に注意．いかに<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Ctheta+" alt="\theta " />が効いているかがわかる</li>
<li>左上はマルコフ連鎖ではない</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>rho in c<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.4</span><span class="p">,</span> <span class="m">0.8</span><span class="p">,</span> <span class="m">0.95</span><span class="p">)){</span>
</span><span class='line'>  x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:<span class="m">1000</span><span class="p">){</span>
</span><span class='line'>    x<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">*</span>rho <span class="o">+</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>    y<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> y<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">*</span>rho <span class="o">+</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;theta=&quot;</span><span class="p">,</span>rho<span class="p">))</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6_extra.png" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「僕がアップルで学んだこと 環境を整えれば人が変わる、組織が変わる」読了]]></title>
    <link href="http://yagays.github.com/blog/2012/11/21/review-apple-matsuhiro/"/>
    <updated>2012-11-21T18:27:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/21/review-apple-matsuhiro</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4048865390" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>元 Apple Inc.のシニアマネージャーの松井博氏による， Appleという会社を通して語られる働き方の指南書である．主にスティーブ・ジョブズやジョナサン・アイヴ，ティム・クックといったトップの人間を中心にして語られることが多いAppleだが，実際の会社内部の体制について語られることは意外と少ない．本書では，実際にアップルで働いた著者の体験談を元に，その企業の姿勢であったり価値観が語られる．そして本書での一番ポイントとなる部分は，松井氏がスティーブ・ジョブズが戻る以前の迷走期から復帰後の社内改革，そしてめざましい躍進ぶりを見せる黄金期にまたがって，Appleという会社を内側から眺め続けてきたところにある．めまぐるしく変わりゆく環境の中で，ジョブズの復帰により会社の環境はどのように変わったのか，そしてAppleが革新的な製品やサービスを作り続けられてきた理由はいったいどこにあるのかを，内部の視点からまとめ上げた一冊となっている．</p>

<p>本書は大きく分けて，職場環境の変革について書かれた前半部と，Apple社員の異常なほどまでの社内政治について書かれた後半部から構成される．前半部の職場環境については，著者が実際に肌で体感してきたアップル社内の変貌を織り交ぜつつ，どうやったら社員がパフォーマンスを発揮し組織として成果を上げていくことができるかといった方法論が語られる．その中では，昨今のApple評で良く耳にするシンプル・コンセプト・デザインなどの基本的な要素から，著者が自分の部署内で実施してきた試行錯誤，そしてスティーブ・ジョブズが打ち出した方向性によってどのように会社としての方向性が明確になったかが，臨場感溢れる語り口で述べられる．一方で，後半部の社内政治においては，一見エンジニアの天国として華やかに見えるApple社内での，外部のイメージとは全く違った熾烈な競争から生じる社内政治について，著者のアメリカ勤務時代の経験が語られる．著者自身は社内政治について良い面も悪い面もあるとしながらも，社内での立ち回りの重要性であったり如何にして成果を自分のものにし失敗を被らずに上司にアピールするかといった，すこし敬遠されがちな内容にまで踏み込んでいる．</p>

<p>本書で語られる経営哲学や仕事内容，上司部下の関係，職場の机のレイアウトに至るまでのエピソードはすべて，いい意味で個人の枠を飛び出していない．あくまで著者自身が社員としてとして会社の中で直面し，感じ，そして考えたかが率直に表現されている．そのため読者としては「Appleだから出来ることでしょ」「外資ベンチャーだから」「シリコンバレーだから」といった壁を作らずに済む．そもそもこの本の構成自体が自分でも何かできることはないだろうかという気持ちにさせるような書き方をしているので，Appleについて全く知らない人にとっても，エンジニアの楽園といった現実離れした妄想を抱いている人たちにとっても，数ある大企業の一つとしてのAppleとして，その会社のことを深く知ることができると思う．お酒の席で知り合いの先輩の人生哲学を聞くような感覚で気軽に読めて，それでいて内容も簡潔にまとまっており，なかなかに面白い本だった．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「データ解析のための統計モデリング入門」読書ノート 8章 MCMCとメトロポリス法]]></title>
    <link href="http://yagays.github.com/blog/2012/11/20/glm-mcmc-chp8/"/>
    <updated>2012-11-20T04:46:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/20/glm-mcmc-chp8</id>
    <content type="html"><![CDATA[<ul>
<li>まとめ：<a href="http://yagays.github.com/blog/2012/10/14/review-glm-mcmc/">「データ解析のための統計モデリング入門」読書ノート</a></li>
<li>前々回：<a href="http://yagays.github.com/blog/2012/11/02/glm-mcmc-chp7/">「データ解析のための統計モデリング入門」読書ノート 7章 GLMMとGLMを比較する</a></li>
<li>前回　：<a href="http://yagays.github.com/blog/2012/11/09/glm-mcmc-chp7-2/">「データ解析のための統計モデリング入門」読書ノート 7章 無限混合分布の生成過程をアニメーションにした</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=400006973X" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>8章の図を再現する</h3>

<p>今回は，本書の8章「マルコフ連鎖モンテカルロ（MCMC）法とベイズ統計モデル」の解析を実際に自分でやってみて，図を再現することを目的とする．基本的に本書の作図を真似するということを目標にして調整しているが，細部で少し違いがあるかもしれないので注意していただきたい．</p>

<h3>問題設定とサンプルデータ</h3>

<p>問題設定は6章と同じく，上限があるカウントデータを用いる．植物個体から8個種子を取ってきた時の種子の生存数が二項分布に従うとした上で，そのときの尤度を最大化し，生存確率であるパラメータqを推定することを目標とする．</p>

<p>まずはサンプルデータと二項分布の対数尤度関数の設定．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>data <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
</span><span class='line'>loglik <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>q<span class="p">){</span>data<span class="o">*</span>log<span class="p">(</span>q<span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">8</span><span class="o">-</span>data<span class="p">)</span><span class="o">*</span>log<span class="p">(</span><span class="m">1</span><span class="o">-</span>q<span class="p">)</span><span class="o">+</span>log<span class="p">(</span>choose<span class="p">(</span><span class="m">8</span><span class="p">,</span>data<span class="p">))}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>図 8.2・8.3</h3>

<p>生存確率qと対数尤度の関係を図示する．8章の解析の大きな特徴としては，この後に出てくるメトロポリス法の説明のために，本来は連続変数である生存確率qを0から1までの0.01刻みの離散値として扱っている点にある．以下の図では，それらの生存確率に対応する対数尤度がマル印で示されてる．</p>

<p>また，解析的に求まる最大対数尤度とその時の生存確率q=0.45625を縦の赤線とバツ印で表示してある．今回は生存確率を離散値として表現しているため，最大対数尤度に対応する対数尤度の値は図示されていない．この図の中では，対数尤度の最大値を取るときの生存確率はq=0.46となっている．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>a <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">0.01</span><span class="p">,</span> <span class="m">0.99</span><span class="p">,</span> by<span class="o">=</span><span class="m">0.01</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>a<span class="p">,</span> apply<span class="p">(</span>matrix<span class="p">(</span>a<span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="kr">function</span><span class="p">(</span>z<span class="p">){</span>sum<span class="p">(</span>loglik<span class="p">(</span>z<span class="p">))}),</span>
</span><span class='line'>     xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.7</span><span class="p">),</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">-60</span><span class="p">,</span><span class="m">-35</span><span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;q&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;log L(q)&quot;</span><span class="p">)</span>
</span><span class='line'>abline<span class="p">(</span>v<span class="o">=</span><span class="m">0.45625</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>points<span class="p">(</span><span class="m">0.45625</span><span class="p">,</span> sum<span class="p">(</span>loglik<span class="p">(</span><span class="m">0.45625</span><span class="p">)),</span> pch<span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="p">,</span>cex<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p> <img src="http://dl.dropbox.com/u/142306/b/glm_mcmc_8_3.png" alt="" /></p>

<h3>図 8.8</h3>

<p>MCMCのアルゴリズムの一つであるメトロポリス法を実際に動かしてサンプリングをしてみる．</p>

<p>メトロポリス法の実装は本書にコード例が無かったので自作している．このコードで使っているアルゴリズムに関しては，本書P.176で述べられている手順を使っているわけではなく，スタンダードなメトロポリス法の手法を用いて先に対数尤度比を求めて条件分岐を作っている．細かい部分で違いはあれど基本的にやっていることは同じで作図もうまくいっているので，たぶん問題はないだろう．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># Metropolis method</span>
</span><span class='line'>niter <span class="o">&lt;-</span> <span class="m">100000</span>
</span><span class='line'>x <span class="o">&lt;-</span> <span class="m">0.30</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:niter<span class="p">){</span>
</span><span class='line'>  z <span class="o">&lt;-</span> sample<span class="p">(</span>c<span class="p">(</span><span class="m">-0.01</span><span class="p">,</span><span class="m">0.01</span><span class="p">),</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  r <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span>loglik<span class="p">(</span>x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">+</span>z<span class="p">)</span><span class="o">-</span>loglik<span class="p">(</span>x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])))</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">if</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> r<span class="p">){</span>
</span><span class='line'>    x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> z
</span><span class='line'>  <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>    x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Fig. 8.8</span>
</span><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:<span class="m">100</span><span class="p">,</span>x<span class="p">[</span><span class="m">1</span>:<span class="m">100</span><span class="p">],</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;100 MC steps&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>x<span class="p">[</span><span class="m">1</span>:<span class="m">100</span><span class="p">]),</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:<span class="m">1000</span><span class="p">,</span>x<span class="p">[</span><span class="m">1</span>:<span class="m">1000</span><span class="p">],</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;1000 MC steps&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>x<span class="p">[</span><span class="m">1</span>:<span class="m">1000</span><span class="p">]),</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:niter<span class="p">,</span>x<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;100000 MC steps&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span>density<span class="p">(</span>x<span class="p">),</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span>  main<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/glm_mcmc_8_1.png" alt="" /></p>

<h3>図 8.9</h3>

<p>メトロポリス法では，ステップ数を大きくしていくとサンプリングの値は定常分布に収束する．しかし，ステップ数が小さい段階では初期値に影響されるため，Burn-inとしてある程度のステップまでの結果を捨てるということが行われる．このように初期値が影響する様子を見るために，以下の図では初期値を0.1から0.9までの0.1刻みとした上でメトロポリス法を実行し，その結果を重ねあわせている．</p>

<p>これを見ると，ステップスを重ねる毎に初期値の影響が少なくなっていくことがわかるが，では実際にどのあたりまでを捨てるべきかという疑問については図を見ても判断できない．Burn-inの範囲設定は色々と手法があるものの，ある程度は実験者の裁量に任されているようだ．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>palette <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;#000000&quot;</span><span class="p">,</span><span class="s">&quot;#999999&quot;</span><span class="p">,</span> <span class="s">&quot;#E69F00&quot;</span><span class="p">,</span> <span class="s">&quot;#56B4E9&quot;</span><span class="p">,</span> <span class="s">&quot;#009E73&quot;</span><span class="p">,</span> <span class="s">&quot;#F0E442&quot;</span><span class="p">,</span> <span class="s">&quot;#0072B2&quot;</span><span class="p">,</span> <span class="s">&quot;#D55E00&quot;</span><span class="p">,</span> <span class="s">&quot;#CC79A7&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># http://wiki.stdout.org/rcookbook/Graphs/Colors%20(ggplot2)/</span>
</span><span class='line'>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:<span class="m">500</span><span class="p">,</span> rep<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">500</span><span class="p">),</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;q&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;500 MC steps&quot;</span><span class="p">)</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>init in seq<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">9</span><span class="p">)){</span>
</span><span class='line'>  niter <span class="o">&lt;-</span> <span class="m">500</span>
</span><span class='line'>  x <span class="o">&lt;-</span> init<span class="o">*</span><span class="m">0.1</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:niter<span class="p">){</span>
</span><span class='line'>    z <span class="o">&lt;-</span> sample<span class="p">(</span>c<span class="p">(</span><span class="m">-0.01</span><span class="p">,</span><span class="m">0.01</span><span class="p">),</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>    r <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span>loglik<span class="p">(</span>x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">+</span>z<span class="p">)</span><span class="o">-</span>loglik<span class="p">(</span>x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])))</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">if</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> r<span class="p">){</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> z
</span><span class='line'>    <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>      x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  lines<span class="p">(</span>x<span class="p">,</span> col<span class="o">=</span>palette<span class="p">[</span>init<span class="p">],</span> ylim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/glm_mcmc_8_2.png" alt="" /></p>

<h4>参考</h4>

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4000068520" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「マルコフ連鎖モンテカルロ法」1章のメトロポリス・ヘイスティング・アルゴリズムによるガンベル分布の乱数生成]]></title>
    <link href="http://yagays.github.com/blog/2012/11/19/mcmc-statlib-chp1-mh/"/>
    <updated>2012-11-19T07:10:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/19/mcmc-statlib-chp1-mh</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4254126972" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>「<a href="http://www.amazon.co.jp/gp/product/4254126972/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4254126972&linkCode=as2&tag=yagays-22">マルコフ連鎖モンテカルロ法 (統計ライブラリー)</a><img src="http://www.assoc-amazon.jp/e/ir?t=yagays-22&l=as2&o=9&a=4254126972" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」PP.11-14のメトロポリス・ヘイスティング・アルゴリズムによる二重指数分布からの乱数生成（サンプリング）をやってみた．</p>

<p>この問題は本書にも実験結果が掲載されているので，自分が行った実験結果と見比べることができる．結論から言うと，一応大まかな結果としては同じ傾向を示したが，乱数を用いた実験ということもあって多少の値のズレがでている．また，パラメータによっては結果の値/分布が安定しないものもあるので，何度か実験を行なって結果を吟味している部分もあるが，結果を曲解するためのものではないということを付け加えておく．</p>

<p>なお，この文章ではメトロポリス・ヘイスティング・アルゴリズムを以降MHと表記する．</p>

<h3>問題</h3>

<p>ガンベル分布（二重指数分布）からの乱数生成を考える．今回はガンベル分布からの直接的な乱数生成ができないとしたうえで，MHによる乱数生成を行う．ガンベル分布は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cfrac%7B1%7D%7B2b%7D%5Cexp%28%5Cfrac%7B-%7Cx-%5Cmu%7C%7D%7Bb%7D%29+" alt="\frac{1}{2b}\exp(\frac{-|x-\mu|}{b}) " />で表され，今回は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmu%3D0+" alt="\mu=0 " />，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=b%3D+3+" alt="b= 3 " />の分布を考える．なお，ガンベル分布の平均と分散は解析的に得られ，それぞれ<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmu+" alt="\mu " />と<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=2b%5E2+" alt="2b^2 " />である．</p>

<h3>実験条件</h3>

<p>今回は，MHの中でも酔歩過程/ランダムウォーク（Random walk）と独立連鎖（Independent chain）の2種類の方法を試す．それぞれのMHにおける推移カーネル<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=K+" alt="K " />は</p>

<ul>
<li>酔歩過程：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=K%28x%5E%7B%28t%29%7D%2Cx%5E%7B%28t%2B1%29%7D%29+%3D+%5Cmathcal%7BN%7D%28x%5E%7B%28t%29%7D%2Cc_%7Bran%7D%5E2%29+" alt="K(x^{(t)},x^{(t+1)}) = \mathcal{N}(x^{(t)},c_{ran}^2) " /></li>
<li>独立連鎖：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=K%28x%5E%7B%28t%29%7D%2Cx%5E%7B%28t%2B1%29%7D%29+%3D+%5Cmathcal%7BN%7D%280%2Cc_%7Bind%7D%5E2%29+" alt="K(x^{(t)},x^{(t+1)}) = \mathcal{N}(0,c_{ind}^2) " /></li>
</ul>


<p>となる．ここで，<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2+" alt="c_{ran}^2 " />および<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2+" alt="c_{ind}^2 " />は調整母数/チューニングパラメータであり，今回はそれぞれ<strong>{0.25, 1, 5, 15, 150}</strong>の5パターンで実験を行った．</p>

<p>また，生成した乱数の系列において，系列初期の<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=t%3D1%5Cdots+1000+" alt="t=1\dots 1000 " />までの結果は初期値に依存した値となっているため，今回は結果として用いていない．</p>

<h3>結果：以下の図の見方</h3>

<p>以下に示す図は，各行にチューニングパラメータの値，各列に系列のプロット，系列の分布，系列の平均の推移，系列の自己相関プロットを示したものである．図のタイトルに，チューニングパラメータの値，生成した乱数の平均と分散，そして採択率を示している（便宜的にタイトルの部分に情報を書き加えているだけで，タイトルと図は直接的には関連していない）．</p>

<h3>結果：酔歩過程/ランダムウォーク</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in c<span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">150</span><span class="p">)){</span>
</span><span class='line'>  c.ran <span class="o">&lt;-</span> i<span class="o">^</span><span class="m">2</span>
</span><span class='line'>  alpha <span class="o">&lt;-</span> numeric<span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span><span class='line'>  Niter <span class="o">&lt;-</span> <span class="m">10000</span>
</span><span class='line'>  x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span>c.ran<span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>    z <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span>c.ran<span class="p">)</span>
</span><span class='line'>    alpha<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>abs<span class="p">(</span>x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">+</span>z<span class="p">)</span><span class="o">-</span>abs<span class="p">(</span>x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]))))</span>
</span><span class='line'>    x<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> z<span class="o">*</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&lt;</span>alpha<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">])</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  X <span class="o">&lt;-</span> x<span class="p">[</span><span class="m">1001</span>:Niter<span class="p">]</span>
</span><span class='line'>  stat <span class="o">&lt;-</span> table<span class="p">(</span>alpha<span class="o">==</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  plot<span class="p">(</span><span class="m">1001</span>:Niter<span class="p">,</span> X<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;c_ran=&quot;</span><span class="p">,</span>i<span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  plot<span class="p">(</span>density<span class="p">(</span>X<span class="p">),</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;mean=&quot;</span><span class="p">,</span>round<span class="p">(</span>mean<span class="p">(</span>X<span class="p">),</span>digit<span class="o">=</span><span class="m">2</span><span class="p">),</span><span class="s">&quot; var=&quot;</span><span class="p">,</span>round<span class="p">(</span>var<span class="p">(</span>X<span class="p">),</span>digit<span class="o">=</span><span class="m">2</span><span class="p">)))</span>
</span><span class='line'>  plot<span class="p">(</span>cumsum<span class="p">(</span>X<span class="p">)</span><span class="o">/</span><span class="m">1</span>:length<span class="p">(</span>X<span class="p">),</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;accept ratio=&quot;</span><span class="p">,</span>round<span class="p">(</span><span class="m">100</span><span class="o">*</span>stat<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">/</span>stat<span class="p">[</span><span class="m">1</span><span class="p">]),</span><span class="s">&quot;%&quot;</span><span class="p">))</span>
</span><span class='line'>  abline<span class="p">(</span>h<span class="o">=</span><span class="m">0</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D0.25+" alt="c_{ran}^2=0.25 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/rand_1.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D1+" alt="c_{ran}^2=1 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/rand_2.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D5+" alt="c_{ran}^2=5 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/rand_3.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D15+" alt="c_{ran}^2=15 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/rand_4.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D150+" alt="c_{ran}^2=150 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/rand_5.png" alt="" /></p>

<h3>結果：独立連鎖の場合</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in c<span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">150</span><span class="p">)){</span>
</span><span class='line'>  c.ind <span class="o">&lt;-</span> i
</span><span class='line'>  alpha <span class="o">&lt;-</span> numeric<span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span><span class='line'>  Niter <span class="o">&lt;-</span> <span class="m">10000</span>
</span><span class='line'>  x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span>c.ind<span class="p">)</span>
</span><span class='line'>  <span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:Niter<span class="p">){</span>
</span><span class='line'>    z <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span>c.ind<span class="p">)</span>
</span><span class='line'>    alpha<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> exp<span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>abs<span class="p">(</span>z<span class="p">)</span><span class="o">-</span>abs<span class="p">(</span>x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]))</span>
</span><span class='line'>                             <span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span>x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="o">/</span>c.ind<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">-</span> <span class="p">(</span>z<span class="o">/</span>c.ind<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>                             <span class="p">)</span>
</span><span class='line'>                      <span class="p">)</span>
</span><span class='line'>    <span class="kr">if</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&lt;</span>alpha<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]){</span>
</span><span class='line'>      x<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> z
</span><span class='line'>    <span class="p">}</span>else<span class="p">{</span>
</span><span class='line'>      x<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> x<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  X <span class="o">&lt;-</span> x<span class="p">[</span><span class="m">1001</span>:Niter<span class="p">]</span>
</span><span class='line'>  stat <span class="o">&lt;-</span> table<span class="p">(</span>alpha<span class="o">==</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  plot<span class="p">(</span><span class="m">1001</span>:Niter<span class="p">,</span> X<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;c_ind=&quot;</span><span class="p">,</span>i<span class="p">),</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  plot<span class="p">(</span>density<span class="p">(</span>X<span class="p">),</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;mean=&quot;</span><span class="p">,</span>round<span class="p">(</span>mean<span class="p">(</span>X<span class="p">),</span>digit<span class="o">=</span><span class="m">2</span><span class="p">),</span><span class="s">&quot; var=&quot;</span><span class="p">,</span>round<span class="p">(</span>var<span class="p">(</span>X<span class="p">),</span>digit<span class="o">=</span><span class="m">2</span><span class="p">)))</span>
</span><span class='line'>  plot<span class="p">(</span>cumsum<span class="p">(</span>X<span class="p">)</span><span class="o">/</span><span class="m">1</span>:length<span class="p">(</span>X<span class="p">),</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> main<span class="o">=</span>paste<span class="p">(</span><span class="s">&quot;accept ratio=&quot;</span><span class="p">,</span>round<span class="p">(</span><span class="m">100</span><span class="o">*</span>stat<span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">/</span>stat<span class="p">[</span><span class="m">1</span><span class="p">]),</span><span class="s">&quot;%&quot;</span><span class="p">),</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">)</span>
</span><span class='line'>  abline<span class="p">(</span>h<span class="o">=</span><span class="m">0</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</span><span class='line'>  acf<span class="p">(</span>X<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2%3D0.25+" alt="c_{ind}^2=0.25 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/ind_1.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2%3D1+" alt="c_{ind}^2=1 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/ind_2.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2%3D5+" alt="c_{ind}^2=5 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/ind_3.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2%3D15+" alt="c_{ind}^2=15 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/ind_4.png" alt="" /></p>

<h4><img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bind%7D%5E2%3D150+" alt="c_{ind}^2=150 " />の場合</h4>

<p><img src="http://dl.dropbox.com/u/142306/b/mcmc_statlib/ind_5.png" alt="" /></p>

<h3>解釈</h3>

<p>さて，このように色々とプロットしてみたわけだが，酔歩過程の場合も独立連鎖の場合もチューニングパラメータの値が0.25や150といった非常に小さい/大きい場合においては，乱数の分布や収束速度などに問題があることがわかる．</p>

<p>酔歩過程においては，マルコフ連鎖の候補点の生成は少しずつ値を移動させていくという点で，分布の表面をなぞる形となる．そのため，チューニングパラメータの値である分散が小さい場合では候補点の移動範囲が狭いため，分布全体を探索するのに非常に時間がかかる．<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=c_%7Bran%7D%5E2%3D0.25+" alt="c_{ran}^2=0.25 " />の図を見ると，系列のプロットではあまり大幅な移動（縦のぶれ）が少なく，生成した乱数の分布もかなりいびつである．また，値があまり変動しないという点で，自己相関係数も非常に大きな値を取っていることがわかる．一方チューニングパラメータの値が大きい場合においては，採択率が非常に小さな値を取り，系列のプロットからも値の変動しない部分が他と比べて多い．</p>

<p>一方，独立連鎖においては，マルコフ連鎖の候補点の生成は現在の状態に依存しない．そのため，酔歩過程のように値を移動させていくということは見られないが，一方で採択確率の部分でチューニングパラメータの値が影響していることがわかる．</p>

<h4>参考</h4>

<ul>
<li><a href="http://d.hatena.ne.jp/syou6162/20081214/1229197092">Example of Metropolis Hastings Algorithm - Seeking for my unique color.</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「Rによるモンテカルロ法入門」読書ノート：6章 メトロポリス・ヘイスティング・アルゴリズム その1]]></title>
    <link href="http://yagays.github.com/blog/2012/11/18/imcmr-6-1/"/>
    <updated>2012-11-18T14:37:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/18/imcmr-6-1</id>
    <content type="html"><![CDATA[<ul>
<li>読書ノート アーカイブ：<a href="http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/">http://yagays.github.com/blog/2012/10/20/archive-introducing-monte-carlo-methods-with-r/</a></li>
</ul>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4621065270" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<h3>例 6.1 メトロポリス・ヘイスティング・アルゴリズムでベータ分布の乱数を生成する</h3>

<p><a href="http://yagays.github.com/blog/2012/10/22/imcmr-2-2/">例2.7</a>では受理・棄却法を用いてベータ分布の乱数を生成したが，本問題ではメトロポリス・ヘイスティング・アルゴリズムを使ってベータ分布からサンプリングを行うことを目的とする．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>a <span class="o">&lt;-</span> <span class="m">2.7</span>
</span><span class='line'>b <span class="o">&lt;-</span> <span class="m">6.3</span>
</span><span class='line'>c <span class="o">&lt;-</span> <span class="m">2.669</span>
</span><span class='line'>Nsim <span class="o">&lt;-</span> <span class="m">5000</span>
</span><span class='line'>X <span class="o">&lt;-</span> rep<span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">),</span> Nsim<span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>i in <span class="m">2</span>:Nsim<span class="p">){</span>
</span><span class='line'>  Y <span class="o">&lt;-</span> runif<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  rho <span class="o">&lt;-</span> dbeta<span class="p">(</span>Y<span class="p">,</span> a<span class="p">,</span> b<span class="p">)</span><span class="o">/</span>dbeta<span class="p">(</span>X<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">],</span> a<span class="p">,</span> b<span class="p">)</span>
</span><span class='line'>  X<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> X<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>Y <span class="o">-</span> X<span class="p">[</span>i<span class="o">-</span><span class="m">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">&lt;</span>rho<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>plot<span class="p">(</span><span class="m">1</span>:Nsim<span class="p">,</span> X<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;Sequence X^t&quot;</span><span class="p">)</span>
</span><span class='line'>plot<span class="p">(</span><span class="m">4500</span>:<span class="m">4800</span><span class="p">,</span> X<span class="p">[</span><span class="m">4500</span>:<span class="m">4800</span><span class="p">],</span> type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Iterations&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;Sequence X^t for t = 4500 - 4800&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>まず，以下の図は系列<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5C%7BX%5E%7B%28t%29%7D%5C%7D+" alt="{X^{(t)}} " />をプロットしたものである．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-1_1.png" alt="" /></p>

<p>そして，その中からシミュレーション回数が4500〜4800回までの系列を抜き出したのが以下の図となっている．このように一部分を拡大して見てみると，系列を表す線が変化せずにx軸に並行に遷移している部分が見られる．これは<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Crho%28x%5E%7B%28t%29%7D%2CY_t%29+" alt="\rho(x^{(t)},Y_t) " />の確率で棄却されて値が変化していないことを表している．これは対応する<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=Y_t+" alt="Y_t " />に依存し，マルコフ連鎖の性質から次の状態にも影響するため，値が変化しない状態が一定期間続くことがあるからである．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-1_2.png" alt="" /></p>

<p>また，得られた系列がベータ分布の乱数となっているかを確かめるため，左側に今回のメトロポリス・ヘイスティング・アルゴリズムで作成した乱数，右側にRの組込み関数rbeta()で生成した乱数をヒストグラムで図示し，今回実験で設定したベータ分布<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BBe%7D%282.7%2C6.3%29+" alt="\mathcal{Be}(2.7,6.3) " />を赤の曲線で表した．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>par<span class="p">(</span>mfrow<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
</span><span class='line'>hist<span class="p">(</span>X<span class="p">,</span> nclass<span class="o">=</span><span class="m">100</span><span class="p">,</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1.0</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;Metropolis-Hastings&quot;</span><span class="p">)</span>
</span><span class='line'>curve<span class="p">(</span>dbeta<span class="p">(</span>x<span class="p">,</span>a<span class="p">,</span>b<span class="p">),</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span><span class='line'>hist<span class="p">(</span>rbeta<span class="p">(</span>Nsim<span class="p">,</span>a<span class="p">,</span>b<span class="p">),</span> freq<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> nclass<span class="o">=</span><span class="m">100</span><span class="p">,</span> xlim<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1.0</span><span class="p">),</span> main<span class="o">=</span><span class="s">&quot;Direct Generation&quot;</span><span class="p">)</span>
</span><span class='line'>curve<span class="p">(</span>dbeta<span class="p">(</span>x<span class="p">,</span>a<span class="p">,</span>b<span class="p">),</span> add<span class="o">=</span><span class="k-Variable">T</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-1_3.png" alt="" /></p>

<p>この図を見ると，メトロポリス・ヘイスティング・アルゴリズムを使った場合でも，受理・棄却法の時と同じく乱数の生成に成功していることがわかる．</p>

<h3>例 6.2 メトロポリス・ヘイスティング・アルゴリズムでコーシー分布の乱数を生成する</h3>

<p>例6.1のベータ分布の乱数生成における提案分布は<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BU%7D_%7B0%2C1%7D+" alt="\mathcal{U}_{0,1} " />だったが，コーシー分布の乱数生成における提案分布には，</p>

<ul>
<li>標準正規分布：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BN%7D%280%2C1%29+" alt="\mathcal{N}(0,1) " /></li>
<li>自由度0.5のスチューデントt分布：<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=%5Cmathcal%7BT%7D_%7B1%2F2%7D+" alt="\mathcal{T}_{1/2} " /></li>
</ul>


<p>を使うことができる．このような提案分布は独立提案分布であり，マルコフ連鎖ではない．</p>

<p>なお，本問題ではこれらの分布を表す単語として候補分布と提案分布という2つの言葉が出てくるが，今回は表記として提案分布で統一する．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1"># Standard Normal Distributionp</span>
</span><span class='line'>Nsim <span class="o">&lt;-</span> <span class="m">10</span><span class="o">^</span><span class="m">4</span>
</span><span class='line'>X <span class="o">&lt;-</span> c<span class="p">(</span>rt<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:Nsim<span class="p">){</span>
</span><span class='line'>  Y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span><span class='line'>  rho <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> dt<span class="p">(</span>Y<span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="o">*</span>dnorm<span class="p">(</span>X<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>dt<span class="p">(</span>X<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">],</span><span class="m">1</span><span class="p">)</span><span class="o">*</span>dnorm<span class="p">(</span>Y<span class="p">)))</span>
</span><span class='line'>  X<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> X<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>Y <span class="o">-</span> X<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> rho<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># t-distribution (0.5 degree of freedom)</span>
</span><span class='line'>X2 <span class="o">&lt;-</span> c<span class="p">(</span>rt<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
</span><span class='line'><span class="kr">for</span><span class="p">(</span>t in <span class="m">2</span>:Nsim<span class="p">){</span>
</span><span class='line'>  Y <span class="o">&lt;-</span> rt<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
</span><span class='line'>  rho <span class="o">&lt;-</span> min<span class="p">(</span><span class="m">1</span><span class="p">,</span> dt<span class="p">(</span>Y<span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="o">*</span>dt<span class="p">(</span>X2<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">],</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>dt<span class="p">(</span>X2<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">],</span><span class="m">1</span><span class="p">)</span><span class="o">*</span>dt<span class="p">(</span>Y<span class="p">,</span> <span class="m">0.5</span><span class="p">)))</span>
</span><span class='line'>  X2<span class="p">[</span>t<span class="p">]</span> <span class="o">&lt;-</span> X2<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>Y <span class="o">-</span> X2<span class="p">[</span>t<span class="o">-</span><span class="m">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span>runif<span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">&lt;</span> rho<span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>まずはそれぞれの系列をプロットして特徴を見ていく．左側に提案分布を標準正規分布とした場合，右側に提案分布をスチューデントt分布とした場合で，上から順に系列のプロット，系列のヒストグラム，系列の自己相関プロットを図示したのが以下の図になっている．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-2_1.png" alt="" /></p>

<p>まずは標準正規分布を使った場合からみていく．系列のプロットは例6.1と同じような形を示しているが，イテレーションが8500を過ぎたあたりで値が一定期間変化しない部分がある．これは乱数から生成する正規候補<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=Y_t+" alt="Y_t " />が大きい（または小さい）値を取ってしまい，連鎖で長い間引きずることになったからである．この現象は，系列のヒストグラムの右端において値が少し大きくなっていることからも確認することができる．</p>

<p>一方，スチューデントt分布を使った場合においては，系列のプロットは0付近で集中しており，たまに正規候補<img src="http://chart.apis.google.com/chart?cht=tx&amp;chl=Y_t+" alt="Y_t " />が非常に大きい値を取ることはあるものの，それが継続して続くわけではないことがわかる．系列のヒストグラムを見ても，標準正規分布の場合と比べて分布がなだらかでコーシー分布に当てはまっていることがわかる．ただし，実際には両端の外れ値を除外して系列のヒストグラムをプロットしているので，このヒストグラムの描写範囲から外れている値があることには注意が必要である．</p>

<br />


<p>次に，2つの提案分布におけるメトロポリス・ヘイスティング・アルゴリズムによって生成したコーシー乱数の累積収束プロット，すなわち乱数の平均値がどのように収束していくかを図示する．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/imcmr/chp6_6-2_2.png" alt="" /></p>

<p>黒線が提案分布に標準正規分布を使った場合，黄色の線が提案分布にスチューデントt分布を使った場合となっている．今回シミュレートしているコーシー分布から求めた正確な値は0.896なので，スチューデントt分布はイテレーション回数を重ねるごとに真の値に収束していくことがわかる．一方で標準正規分布においては，今回のイテレーション回数(N=5000)では真の値に収束していないようにみえる．しかし，平均値の傾向を見ると値が徐々に上昇しては一気に下がり&#8230;といった傾向が見られ，理論的にも標準正規分布を提案分布として用いた場合でも真の値に収束することがわかっている．なので，今回の場合はイテレーション回数が少なすぎるために，収束の様子が見られない．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sublime Text 2でRVM環境のOctopressを操作する]]></title>
    <link href="http://yagays.github.com/blog/2012/11/17/sublime-text-2-octopress-package/"/>
    <updated>2012-11-17T01:59:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/17/sublime-text-2-octopress-package</id>
    <content type="html"><![CDATA[<p>Sublime Text 2でOctopressの基本コマンドを実行できるパッケージを使ってみた．</p>

<ul>
<li><a href="http://blueplanet.github.com/blog/2012/10/16/sublime-text-2-octopress/">http://blueplanet.github.com/blog/2012/10/16/sublime-text-2-octopress/</a></li>
</ul>


<h3>1. sublime-text-2-octopressをインストールする</h3>

<p>Package Controlでsublime-text-2-octopressをインストールする．これは定石通り．</p>

<h3>2. Octopress.sublime-settingsを編集する</h3>

<p>sublime-text-2-octopressの環境設定を行う．Sublime Text 2のメニューバーから&#8221;Sublime Text 2&#8221;→&#8221;Preferences&#8221;→&#8221;Package Settings&#8221;→&#8221;Octopress&#8221;→&#8221;Settings-User&#8221;でOctopress.sublime-settingsを開く．</p>

<p>今回設定するのは&#8221;octopress_path&#8221;と&#8221;octopress_cmd_before_rake&#8221;の2箇所．&#8221;octopress_path&#8221;はOctopressのディレクトリを指定する．そして&#8221;octopress_cmd_before_rake&#8221;にはrubyやrakeのパスを通す設定を読み込むコマンドを指定するのだが，下手に.zshrcなどを読み込むと不要な設定が多すぎてエラーになってしまうので注意が必要になる．自分の環境の場合，RubyはRVMで管理しているため，&#8221;octopress_cmd_before_rake&#8221;にはRVMの設定ファイルである<strong>&#8220;$HOME/rvm/scripts/rvm&#8221;</strong>を読み込むように指定する．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  // path to your octopress
</span><span class='line'>  "octopress_path": "/Users/yag_ays/Dropbox/octopress",  
</span><span class='line'>  // command to run before calling rake, eg source ~/.bash_profile to set up your local environment inc paths to ruby, rake etc.
</span><span class='line'>  "octopress_cmd_before_rake" : "source /Users/yag_ays/.rvm/scripts/rvm",
</span><span class='line'>  // set to generate, deploy or generate_and_deploy if you wish to have your changes generated into the /public folder and/or deployed upon file save
</span><span class='line'>  "octopress_onsave_action": "",
</span><span class='line'>  // true or false
</span><span class='line'>  "use_bundle": false
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3. OctopressのNew Postを実行してみる</h3>

<p>それでは試しに新しい記事を書いてみる．Command Paletteで「octopress」と入力すると，sublime-text-2-octopressでサポートされているコマンド一覧が表示される．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/20121115subl_octopress_1.png" alt="" /></p>

<p>「Octopress: New Post」を選択すると，画面下にタイトルを入力する欄が表示される．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/20121115subl_octopress_2.png" alt="" /></p>

<p>タイトルを入力してEnterを押すと，Octopressのテンプレートが表示され，New Postが実行される．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/20121115subl_octopress_3.png" alt="" /></p>

<p>この他にも，既存のPostやPageを編集したり，GenerateやDeployができる仕様となっている．</p>

<h4>参考</h4>

<ul>
<li><a href="http://blueplanet.github.com/blog/2012/10/16/sublime-text-2-octopress/">sublime text 2 の octopress プラグインを作ってみました - Welcome to the blog of blueplanet</a></li>
<li><a href="https://github.com/blueplanet/sublime-text-2-octopress">blueplanet/sublime-text-2-octopress</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sublime Text 2のSublimeREPLパッケージでClojureを動かす]]></title>
    <link href="http://yagays.github.com/blog/2012/11/16/sublimerepl-clojure/"/>
    <updated>2012-11-16T00:07:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/16/sublimerepl-clojure</id>
    <content type="html"><![CDATA[<p>最近ローカルの開発環境をEmacsから<a href="http://www.sublimetext.com/">Sublime Text 2</a>に乗り換えたので，長い間.emacsに溜め込んだ環境をSublime Text 2でも再現するために，ちまちまと移行作業をしている．Sublime Text 2の強みというのはPythonで拡張パッケージが書ける上にパッケージ管理が非常に簡単というところにあると思っていて，とりあえずデフォルトの環境をなんとかしたいと思えばパッケージを探せば何とかなる．</p>

<p>ということで，今回はEmacsで構築していたClojureの開発環境を，SublimeREPLパッケージを使ってSublime Text 2で再現してみる．Emacsではswank-clojureとslime-replで書いたコードを逐次実行できる環境を作っていたが，今回もSublime Text 2内でClojureを動かして，エディタ内でコードの編集と実行を両立できるようにする．なお，今回の環境構築ではClojureやLeiningenのインストールはひと通り終えているものとする．</p>

<p>ちなみに，私の過去のEmacs＆Clojure環境は以下のblogにまとめてある．</p>

<ul>
<li><a href="http://yag-ays.hateblo.jp/entry/2012/01/09/224531">Clojure + Emacs環境のセッティング（MacOSX Lion 10.7） - やぐブロ</a></li>
</ul>


<h3>1. Package Controlをインストールする</h3>

<p>これについては他のサイトでもよく解説されていることなので，簡単に紹介とインストール方法だけ．Sublime Text 2では<a href="http://wbond.net/sublime_packages/package_control">Sublime Package Control</a>というパッケージ管理が定番となっていて，Sublime Text 2内のコマンドから検索・インストール・最新バージョンへの更新などを簡単に行うことができる．</p>

<p>まず，Sublime Text 2のコンソールに以下のコマンドを入力（コピペ）する．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">urllib2</span><span class="o">,</span><span class="nn">os</span><span class="p">;</span><span class="n">pf</span><span class="o">=</span><span class="s">&#39;Package Control.sublime-package&#39;</span><span class="p">;</span><span class="n">ipp</span><span class="o">=</span><span class="n">sublime</span><span class="o">.</span><span class="n">installed_packages_path</span><span class="p">();</span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ipp</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ipp</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span><span class="p">;</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">pf</span><span class="p">),</span><span class="s">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&#39;http://sublime.wbond.net/&#39;</span><span class="o">+</span><span class="n">pf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;%20&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>インストールが終了したら，Sublime Text 2を再起動する．メニューバーの&#8221;Tools&#8221;からCommand Paletteを開いて「package」と入力して，以下のようにPackage Controlのコマンドが表示されればOK．これでパッケージのインストールが簡単に行えるようになる．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/subl_1.png" alt="" /></p>

<br />


<h3>2. SublimeREPLをインストールする</h3>

<p>次に，Clojureをエディタ内で動かすためにSublimeREPLというパッケージをインストールする．ちなみにこのパッケージはClojure専用というわけではないので，RubyやPython，Rなどの他の言語のREPLの機能も兼ね備えている．</p>

<p>まず，先ほどの確認のときのようにCommand Paletteを開いて「install」と入力し，「Package Control: Install Package」を選択する．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/subl_2.png" alt="" /></p>

<p>すると，登録されているパッケージ一覧が表示されるので，「SublimeREPL」と入力してパッケージを選択してインストールを行う．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/subl_3.png" alt="" /></p>

<p>これで，SublimeREPLパッケージのインストールは完了．メニューバーのToolsにSublimeREPLという項目が表示されればOK．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/subl_4.png" alt="" /></p>

<br />


<h3>3. SublimeREPLの環境設定にLeiningenのPATHを追記する</h3>

<p>最後に，SublimeREPLの環境設定を行う．具体的にはLeiningenがインストールされているディレクトリにPATHを通すのだが，これをしないと「OSError(2, &#8216;No such file or directory&#8217;)」といったエラーが表示されるので注意．</p>

<p>今回の場合は，パッケージ内の設定ファイルに直接追記することにする．まず，SublimeREPLのパッケージのディレクトリ内にあるClojureのMain.sublime-menuというファイルを開く．これには，Sublime Text 2の&#8221;Preference&#8221;→&#8221;Browse Packages…&#8221;でFinderを表示してディレクトリを辿っても良いが，今回はTerminal.appで以下のコマンドを入力する．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>open <span class="nv">$HOME</span>/Library/Application<span class="se">\ </span>Support/Sublime<span class="se">\ </span>Text<span class="se">\ </span>2/Packages/SublimeREPL/config/Clojure/
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://dl.dropbox.com/u/142306/b/subl_5.png" alt="" /></p>

<p>そして，Finderで表示された中にあるMain.sublime-menuをエディタで読み込み，29行目のextend_envの行にLeiningenがあるディレクトリのPATHを入力する．今回はMacPortsで入れたLeiningenを使用するために，/opt/local/binを指定する．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;extend_env&quot;</span>: <span class="o">{</span><span class="s2">&quot;INSIDE_EMACS&quot;</span>: <span class="s2">&quot;1&quot;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>と書かれている行の末尾に「&#8221;PATH&#8221;: &#8220;{PATH}:/opt/local/bin/&#8221;」を追記する．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;extend_env&quot;</span>: <span class="o">{</span><span class="s2">&quot;INSIDE_EMACS&quot;</span>: <span class="s2">&quot;1&quot;</span>, <span class="s2">&quot;PATH&quot;</span>: <span class="s2">&quot;{PATH}:/opt/local/bin/&quot;</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. SublimeREPLの起動</h3>

<p>メニューバーの&#8221;Tools&#8221;から&#8221;SublimeREPL&#8221;→&#8221;Clojure&#8221;→&#8221;Clojure&#8221;を選択して，以下のようにREPLが起動すれば，無事にSublimeREPLの環境設定は終了．</p>

<p><img src="http://dl.dropbox.com/u/142306/b/subl_6.png" alt="" /></p>

<h4>環境</h4>

<ul>
<li>OS

<ul>
<li>Mac OS X 10.8.2</li>
</ul>
</li>
<li>Sublime Text 2

<ul>
<li>Version 2.0.1, Build 2217</li>
</ul>
</li>
<li>Leiningen

<ul>
<li>Leiningen 1.6.1.1</li>
</ul>
</li>
</ul>


<h4>参考</h4>

<ul>
<li><a href="http://wbond.net/sublime_packages/package_control">Sublime Package Control – a Sublime Text 2 Package Manager by wbond</a></li>
<li><a href="http://sublimerepl.readthedocs.org/en/latest/">SublimeREPL — SublimeREPL 1.0.30 documentation</a></li>
<li><a href="https://github.com/wuub/SublimeREPL/issues/11">Opening clojure REPL fails / Fix PATH problems · Issue #11 · wuub/SublimeREPL</a></li>
<li><a href="http://dev.clojure.org/display/doc/Getting+Started+With+Sublime+Text+2">Getting Started With Sublime Text 2 - Clojure Documentation - Clojure Development</a></li>
<li><a href="https://gist.github.com/2407109">Setting Up Clojure on OS X — Gist</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「WIRED VOL.5」読了]]></title>
    <link href="http://yagays.github.com/blog/2012/11/15/review-wired-5/"/>
    <updated>2012-11-15T03:24:00+09:00</updated>
    <id>http://yagays.github.com/blog/2012/11/15/review-wired-5</id>
    <content type="html"><![CDATA[<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B008IWXLBC" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" align="right"></iframe>


<p>相変わらずデザイナーの実験場のような雑誌だ．ページレイアウトを重視するあまり規定ページ数から溢れた記事の一部を巻末に押しやるという普通なら考えられないことをするのは，この雑誌だけなんじゃないかと思う．そんな雑誌の作り方をしていることもあってか，ページをペラペラめくりながら目に留まった記事を片っ端から読んでいくという読み方も楽しいし，やはり1冊の雑誌として興味あるもの無いものを混ぜこぜにして読めるのは，紙媒体だからこそできる体験だろう．個人的には，なんだかんだ言って雑誌は紙の方が好きだ．机の上に置いてあるだけで何度も開いて読みたくなる．</p>

<p>本号の特集は「教育」ということで，オンラインで大学の授業を受けられる<a href="http://www.udacity.com">Udacity</a>・<a href="https://www.coursera.org">Coursera</a>などのプログラムや，TEDやMITメディアラボなどの取り組みも紹介される．この特集の他には，Twitter創業者の一人のジャック・ドーシーのインタビューやスタートアップの紹介，宇宙やSF，面白ガジェットなどなど，普段<a href="http://wired.jp/">WIRED.jp</a>で見かけるようなタイプの記事を，多彩な写真・画像とボリュームある記事で読むことができる．個人的には伊藤計劃などのSFまわりの海外展開やマルチメディア展開が興味深かった．こういった裏で着々と進行していくプロジェクトなんかは，ニュース記事などで断片がポツポツと出てくるくらいで忘れた頃にまた続報がといったことになることが多いので，こうやってひとつの記事として出てきてくれると記憶にも残りやすい．</p>

<p>そういえば，最近定期購読している雑誌はWIREDくらいだ．去年に新装してから買い続けていることになる．前々からよく読んでいるWEB+DB PRESSとSoftware Designは気になる記事があれば買う程度なので，不定期ながらも情報源やネタ帳として軽い感じで楽しめるWIREDはある意味貴重な存在になっている．</p>

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B004UEPGYW" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B005M16XXU" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B0070V8RF2" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=yagays-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=B007K57V1O" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

]]></content>
  </entry>
  
</feed>
